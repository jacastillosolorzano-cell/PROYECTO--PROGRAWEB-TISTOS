import{d as v,r as t,j as e,X as E}from"./index-D4ZRzdJO.js";import{B as b}from"./button-DPY19bWe.js";import{D as R,a as M,b as O}from"./dialog-Br-H6xZz.js";import{a as S}from"./index-B9ygI19o.js";import{G as A}from"./gift-V0G3ICMR.js";import{u as T}from"./use-user-pr7LtClN.js";import{B as D}from"./config-DABtjQED.js";import{M as _}from"./music-2-CbPC-SOp.js";import{B as L}from"./BottomNav-D8fGSJon.js";const I=v("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);const P=v("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);const $=v("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);const B=v("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),U="/PROYECTO--PROGRAWEB-TISTOS/assets/tomba-BDZHZMqZ.png",G="/PROYECTO--PROGRAWEB-TISTOS/assets/Dina-ChyTXk3Y.png";function H({gift:a,visible:l,onClose:n,durationMs:o=3500}){const[i,d]=t.useState(l),s=t.useRef(null);return t.useEffect(()=>{if(d(l),s.current&&(window.clearTimeout(s.current),s.current=null),!!l)return s.current=window.setTimeout(()=>{d(!1),n(),s.current=null},o),()=>{s.current&&(window.clearTimeout(s.current),s.current=null)}},[l,o,n]),t.useEffect(()=>()=>{s.current&&(window.clearTimeout(s.current),s.current=null)},[]),a?e.jsx("div",{className:`fixed right-8 top-20 z-50 pointer-events-auto transform-gpu ${i?"animate-slide-in":"animate-slide-out"}`,onClick:()=>{s.current&&(window.clearTimeout(s.current),s.current=null),d(!1),n()},children:e.jsxs("div",{className:"flex items-center gap-4 bg-gradient-to-r from-pink-500 to-secondary p-4 rounded-2xl shadow-glow text-white min-w-[300px] max-w-md",children:[e.jsx("img",{src:a.imagen,alt:a.nombre,className:"w-20 h-20 object-contain"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-extrabold text-lg",children:"Â¡Recibiste un regalo!"}),e.jsx("div",{className:"text-md opacity-95",children:a.nombre})]})]})}):null}const C="http://localhost:5002",V=[{id_regalo:"tomba",nombre:"Tomba",costo_monedas:2,puntos_otorgados:20,imagen:U,descripcion:"Para que nunca te falte el pasaje",ancho:100,alto:100},{id_regalo:"dina",nombre:"Dina",costo_monedas:10,puntos_otorgados:100,imagen:G,descripcion:"Para tu sopa, segundo y postrecito",ancho:150,alto:75}];function z(){const[a,l]=t.useState("principal"),[n,o]=t.useState(0),[i,d]=t.useState(""),[s,f]=t.useState(null),[g,c]=t.useState(!1),[x,j]=t.useState(null),[h,r]=t.useState(!1),m=localStorage.getItem("id_usuario");localStorage.getItem("id_streamer_actual"),localStorage.getItem("sesion_actual");async function u(){try{if(!m)return;const p=await S.get(`${C}/espectadores/${m}/saldo`);o(p.data.saldo_monedas||0)}catch(p){console.log("Error cargando saldo:",p)}}t.useEffect(()=>{u()},[]);const N=async p=>{const y=localStorage.getItem("id_usuario"),k=localStorage.getItem("id_streamer_actual");if(!y||!k){d("Error: falta informaciÃ³n del usuario o streamer.");return}try{const w=await S.post(`${C}/regalos/enviar`,{id_espectador:y,id_streamer:k,id_regalo:p.id_regalo,cantidad:1});o(w.data.saldo_monedas),d("Regalo enviado correctamente!"),j(p),c(!0)}catch(w){console.log(w),d("Error al enviar regalo.")}};return e.jsxs("div",{children:[e.jsx("button",{className:"flex items-center gap-2 bg-pink-500 hover:bg-pink-600 text-white font-semibold px-4 py-2 rounded-xl shadow-md transition",onClick:()=>r(!0),children:"ðŸŽ"}),e.jsx(R,{open:h,onOpenChange:r,children:e.jsx(M,{className:"sm:max-w-md",children:e.jsxs(O,{children:[e.jsxs("div",{className:"border-b-2 border-white pb-2 mb-4 flex items-center justify-between",children:[e.jsx("h1",{className:"text-pink-600 text-3xl font-bold",children:"Regalos"}),e.jsxs("div",{className:"text-right",children:[e.jsx("h1",{className:"text-muted-foreground",children:"Saldo"}),e.jsxs("h1",{className:"text-2xl font-bold",children:[n," MONEDAS"]})]})]}),a==="principal"&&e.jsx("div",{className:"relative flex justify-start items-start gap-6 min-h-[200px]",children:V.map(p=>e.jsx("button",{onClick:()=>{f(p),l("dialogo2")},className:"hover:scale-105 transition",children:e.jsx("img",{src:p.imagen,className:"w-10 h-10 object-contain"})},p.id_regalo))}),i&&e.jsx("div",{className:"max-w-xl mx-auto mb-2 text-center text-primary font-semibold",children:i}),a==="dialogo2"&&s&&e.jsxs("div",{className:"max-w-md mx-auto bg-card rounded-xl p-6 text-center",children:[e.jsxs("h3",{className:"text-xl font-bold mb-3 flex items-center justify-center gap-2",children:[e.jsx(A,{className:"w-5 h-5 text-primary"})," ",s.nombre]}),e.jsx("img",{src:s.imagen,style:{width:s.ancho,height:s.alto,objectFit:"contain",margin:"0 auto"},className:"mb-4"}),e.jsxs("p",{className:"text-sm mb-1",children:["Costo: ",s.costo_monedas]}),e.jsxs("p",{className:"text-sm mb-1",children:["Puntos: ",s.puntos_otorgados]}),e.jsx("p",{className:"text-sm mb-4",children:s.descripcion}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx(b,{variant:"secondary",onClick:()=>N(s),children:"Enviar regalo"}),e.jsx(b,{variant:"outline",onClick:()=>l("principal"),children:"Volver"})]})]})]})})}),e.jsx(H,{gift:x?{nombre:x.nombre,imagen:x.imagen}:null,visible:g,onClose:()=>c(!1)})]})}const J=a=>{const l=Math.floor((Date.now()-a)/1e3);if(l<60)return`${l}s`;const n=Math.floor(l/60);if(n<60)return`${n}m`;const o=Math.floor(n/60);return o<24?`${o}h`:`${Math.floor(o/24)}d`},F=({onClose:a,sessionId:l})=>{const[n,o]=t.useState(""),[i,d]=t.useState([{id:1,text:"Â¡QuÃ© buen video!",user:"user_ana-nivel 8â­",likes:3,createdAt:Date.now()-1e3*60*5},{id:2,text:"La ediciÃ³n estÃ¡ top ðŸ”¥",user:"creador123-nivel 10â­",likes:5,createdAt:Date.now()-1e3*60*60}]),s=220;t.useEffect(()=>{try{const r=localStorage.getItem("comments_demo");r&&d(JSON.parse(r))}catch{}},[]),t.useEffect(()=>{try{localStorage.setItem("comments_demo",JSON.stringify(i))}catch{}},[i]);const f=t.useRef(null),g=t.useRef(null),{user:c,setCurrentUser:x}=T();t.useEffect(()=>{f.current?.focus()},[]),t.useEffect(()=>{g.current&&(g.current.scrollTop=g.current.scrollHeight)},[i]);const j=()=>{if(n.trim()===""||n.length>s)return;const r={id:Date.now(),text:n.trim(),user:c?.name&&c.name!=="Usuario Invitado"?c.name:"ulima123 - nivel 5 â­",likes:0,createdAt:Date.now()};d(m=>{const u=[...m,r];try{localStorage.setItem("comments_demo",JSON.stringify(u))}catch{}return u}),o(""),(async()=>{try{if(!l){x({points:(c?.points||0)+1});return}const m=await fetch(`${D}/sesiones/${l}/mensajes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_espectador:c?.id,contenido:r.text})});if(!m.ok){console.warn("Error al enviar mensaje al backend",await m.text()),x({points:(c?.points||0)+1});return}const u=await m.json();typeof u.puntos_actuales=="number"?x({points:u.puntos_actuales}):x({points:(c?.points||0)+1})}catch(m){console.error("Error enviando mensaje:",m),x({points:(c?.points||0)+1})}})()},h=r=>{d(m=>m.map(u=>u.id===r?{...u,likes:u.likes+1}:u))};return e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex justify-center items-end",onClick:a,"aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:"bg-background w-full max-w-2xl h-[75%] rounded-t-2xl grid grid-rows-[auto_1fr_auto] overflow-hidden shadow-xl mb-16",onClick:r=>r.stopPropagation(),children:[e.jsxs("header",{className:"flex items-center justify-between border-b p-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-muted flex items-center justify-center font-bold",children:"A"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold",children:"Comentarios"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[i.length," comentarios"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"text-right mr-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Comentando como"}),e.jsx("div",{className:"text-sm font-medium",children:c?.name&&c.name!=="Usuario Invitado"?c.name:"ulima123"})]}),e.jsx(b,{variant:"ghost",size:"icon",onClick:a,"aria-label":"Cerrar",children:e.jsx(E,{className:"w-5 h-5"})})]})]}),e.jsx("div",{ref:g,className:"overflow-y-auto p-4 space-y-3",children:i.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"AÃºn no hay comentarios. Â¡SÃ© el primero!"}):i.map(r=>e.jsxs("div",{className:"flex gap-3 items-start",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-pink-500 to-yellow-400 flex items-center justify-center text-white font-bold",children:r.user.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-sm",children:r.user}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Â· ",J(r.createdAt)]})]}),e.jsx("div",{className:"text-sm mt-1",children:r.text}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-muted-foreground",children:[e.jsxs("button",{onClick:()=>h(r.id),className:"flex items-center gap-1 text-rose-500",children:[e.jsx(I,{className:"w-4 h-4"}),e.jsx("span",{children:r.likes})]}),e.jsx("button",{onClick:()=>{o(`@${r.user} `),f.current?.focus()},className:"text-muted-foreground",children:"Responder"})]})]})]},r.id))}),e.jsxs("footer",{className:"flex items-center gap-2 border-t p-4 pb-6",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-muted flex items-center justify-center font-bold",children:"J"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("input",{ref:f,type:"text",placeholder:"AÃ±ade un comentario...",value:n,onChange:r=>o(r.target.value),onKeyDown:r=>r.key==="Enter"&&j(),className:"w-full bg-muted border rounded-full px-4 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-primary","aria-label":"AÃ±adir comentario",maxLength:s}),e.jsxs("div",{className:"flex justify-between text-xs mt-1 text-muted-foreground",children:[e.jsxs("span",{className:`${n.length>s?"text-rose-500":""}`,children:[n.length,"/",s]}),e.jsx("span",{className:"text-muted-foreground",children:"Pulsa Enter para enviar"})]})]}),e.jsx(b,{onClick:j,className:"shrink-0",disabled:n.trim()===""||n.length>s,children:"Publicar"})]})]})})},Z=({video:a,isActive:l})=>{const[n,o]=t.useState(!1),[i,d]=t.useState(a.likes),s=t.useRef(null),[f,g]=t.useState(!1);t.useEffect(()=>{s.current&&(l?s.current.play():(s.current.pause(),s.current.currentTime=0))},[l]);const c=()=>{o(!n),d(n?i-1:i+1)},x=({streamerId:h})=>null,j=h=>h>=1e6?(h/1e6).toFixed(1)+"M":h>=1e3?(h/1e3).toFixed(1)+"K":h.toString();return e.jsxs("div",{className:"snap-item relative h-screen w-screen bg-black",children:[e.jsxs("div",{className:"absolute inset-0",children:[e.jsx("video",{ref:s,className:"h-screen w-screen object-cover",loop:!0,muted:!0,playsInline:!0,poster:`https://picsum.photos/1080/1920?random=${a.id}`,children:e.jsx("source",{src:a.videoUrl,type:"video/mp4"})}),e.jsx("div",{className:"absolute inset-0 gradient-overlay"})]}),e.jsx("button",{className:"absolute inset-0 flex items-center justify-center z-10 group",tabIndex:-1,style:{pointerEvents:"none"},children:e.jsx("div",{className:"opacity-0 group-active:opacity-100 transition-opacity duration-200",children:e.jsx($,{className:"w-20 h-20 text-white drop-shadow-2xl",fill:"white"})})}),e.jsxs("div",{className:"absolute right-4 bottom-24 z-30 flex flex-col gap-6",children:[e.jsx("div",{className:"mb-2",children:e.jsx(x,{streamerId:a.streamerId})}),e.jsx(z,{}),e.jsx("div",{className:"flex flex-col items-center",children:e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:a.avatar,alt:a.username,className:"w-12 h-12 rounded-full border-2 border-white"}),e.jsx("button",{className:"absolute -bottom-2 left-1/2 -translate-x-1/2 w-6 h-6 rounded-full bg-primary flex items-center justify-center text-white text-xl font-bold",children:"+"})]})}),e.jsxs("button",{onClick:c,className:"flex flex-col items-center gap-1",children:[e.jsx(I,{className:`w-8 h-8 transition-all ${n?"fill-primary text-primary animate-heart-pop":"text-white"}`}),e.jsx("span",{className:"text-white text-xs font-semibold text-shadow",children:j(i)})]}),e.jsxs("button",{onClick:()=>g(!0),className:"flex flex-col items-center gap-1",children:[e.jsx(P,{className:"w-8 h-8 text-white"}),e.jsx("span",{className:"text-white text-xs font-semibold text-shadow",children:j(a.comments)})]}),e.jsxs("button",{className:"flex flex-col items-center gap-1",children:[e.jsx(B,{className:"w-8 h-8 text-white"}),e.jsx("span",{className:"text-white text-xs font-semibold text-shadow",children:j(a.shares)})]}),e.jsx("button",{className:"flex flex-col items-center gap-1",children:e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center",children:e.jsx(_,{className:"w-5 h-5 text-white"})})})]}),e.jsxs("div",{className:"absolute bottom-24 left-4 right-20 z-20 animate-slide-up",children:[e.jsxs("h3",{className:"text-white font-bold text-lg mb-1 text-shadow",children:["@",a.username]}),e.jsx("p",{className:"text-white text-sm mb-2 text-shadow line-clamp-2",children:a.caption}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4 text-white"}),e.jsx("p",{className:"text-white text-xs text-shadow truncate",children:a.music})]})]}),f&&e.jsx(F,{sessionId:a.id,onClose:()=>g(!1)})]})},q=[{id:"1",videoUrl:"https://samplelib.com/mp4/sample-5s.mp4",username:"traveler_soul",avatar:"https://api.dicebear.com/7.x/avataaars/svg?seed=Felix",caption:"Chasing sunsets ðŸŒ… #travel #nature",likes:12400,comments:234,shares:89,music:"Summer Vibes â€¢ Chill Beats",sessionId:"session-1",streamerId:"streamer-1"},{id:"2",videoUrl:"https://www.w3schools.com/html/movie.mp4",username:"urban_explorer",avatar:"https://api.dicebear.com/7.x/avataaars/svg?seed=Aneka",caption:"City lights never sleep ðŸŒƒ #citylife #night",likes:23100,comments:456,shares:123,music:"Neon Dreams â€¢ Synthwave",sessionId:"session-2",streamerId:"streamer-2"},{id:"3",videoUrl:"https://www.w3schools.com/html/mov_bbb.mp4",username:"ocean_lover",avatar:"https://api.dicebear.com/7.x/avataaars/svg?seed=Lily",caption:"Ocean therapy ðŸŒŠ #beach #relax",likes:34500,comments:678,shares:234,music:"Ocean Waves â€¢ Nature Sounds",sessionId:"session-3",streamerId:"streamer-3"},{id:"4",videoUrl:"https://filesamples.com/samples/video/mp4/sample_640x360.mp4",username:"mountain_climber",avatar:"https://api.dicebear.com/7.x/avataaars/svg?seed=Max",caption:"Reaching new heights â›°ï¸ #adventure #hiking",likes:18900,comments:345,shares:167,music:"Epic Journey â€¢ Orchestral",sessionId:"session-4",streamerId:"streamer-4"}],K=()=>{const[a,l]=t.useState(0),n=t.useRef(null);return t.useEffect(()=>{const o=n.current;if(!o)return;const i=()=>{const d=o.scrollTop,s=window.innerHeight,f=Math.round(d/s);l(f)};return o.addEventListener("scroll",i),()=>o.removeEventListener("scroll",i)},[]),e.jsx("div",{ref:n,className:"h-screen overflow-y-auto snap-y snap-mandatory",children:q.map((o,i)=>e.jsx(Z,{video:o,isActive:i===a},o.id))})},ne=()=>e.jsxs("div",{className:"relative min-h-screen bg-background",children:[e.jsx("div",{className:"p-4 flex justify-center"}),e.jsx(K,{}),e.jsx(L,{})]});export{ne as default};
