import{r as n,u as S,j as e,L as E,B as m,a as u}from"./index-Bok9vmhg.js";import{B as f}from"./button-C1FW-hxW.js";import{L as p,I as h}from"./label-2OiBy0YG.js";import{A as T}from"./arrow-left-CvRI0O8X.js";import{V as I}from"./video-3Dqgceo1.js";const P=()=>{const[c,N]=n.useState(""),[a,y]=n.useState(""),[t,v]=n.useState(""),[x,r]=n.useState(""),o=S(),b=async s=>{if(s.preventDefault(),!c||!a||!t){r("Completa todos los campos");return}try{const i=await fetch(`${m}/usuarios/crear`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({nombre:c,email:a,contra:t,rol:"ESPECTADOR",estado:"ACTIVO"})}),g=await i.json();if(!i.ok){r(g.error||"Error al registrarse");return}const O=g,j=await fetch(`${m}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({correo:a,contrasena:t})}),C=await j.json();if(!j.ok){u.success("Usuario creado. Inicia sesión para continuar."),r(""),o("/login");return}const{token:l,usuario:d}=C;if(!l||!d){u.success("Usuario creado. Inicia sesión para continuar."),r(""),o("/login");return}localStorage.setItem("authToken",l),localStorage.setItem("usuario",JSON.stringify(d));try{await fetch(`${m}/usuarios/${d.id_usuario}/inicializar-perfil`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`}})}catch(w){console.error("Error al inicializar perfil:",w)}u.success("Cuenta creada e iniciada sesión correctamente"),r(""),o("/index")}catch(i){r("Error al conectar con el servidor"),console.error(i)}};return e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-background p-4 relative",children:[e.jsx(f,{variant:"ghost",size:"icon",className:"absolute top-4 left-4",onClick:()=>o(-1),children:e.jsx(T,{className:"w-5 h-5"})}),e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 mb-4",children:[e.jsx(I,{className:"w-10 h-10 text-primary"}),e.jsx("h1",{className:"text-4xl font-bold gradient-primary bg-clip-text",children:"Tistos"})]}),e.jsx("p",{className:"text-muted-foreground",children:"Crea tu cuenta"})]}),e.jsxs("div",{className:"glassmorphism p-8 rounded-2xl space-y-6",children:[e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"nombre",children:"Nombre"}),e.jsx(h,{id:"nombre",type:"text",placeholder:"nombre o usuario",value:c,onChange:s=>N(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"email",children:"Correo"}),e.jsx(h,{id:"email",type:"email",placeholder:"tistos@email.com",value:a,onChange:s=>y(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{htmlFor:"password",children:"Contraseña"}),e.jsx(h,{id:"password",type:"password",placeholder:"Contraseña",value:t,onChange:s=>v(s.target.value),required:!0})]}),x&&e.jsx("div",{className:"text-red-500 text-sm text-center",children:x}),e.jsx(f,{type:"submit",className:"w-full",children:"Registrarse"})]}),e.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:["¿Ya tienes una cuenta?"," ",e.jsx(E,{to:"/login",className:"text-primary hover:underline",children:"Inicia sesión"})]})]})]})]})};export{P as default};
