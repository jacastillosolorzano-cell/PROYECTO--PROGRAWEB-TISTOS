import{e as A,r as o,j as e,b as c,B as u,a as B}from"./index-2LlJjRq3.js";import{l as J}from"./index-CA1CrNgP.js";import{B as C}from"./button-DJt9tRzL.js";import{O as V}from"./OverlayAnimator-B6c3h2kN.js";import{A as D}from"./arrow-left-BNXp1jLN.js";const G=A("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);const F=A("Gift",[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]]);const U=A("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);const W=A("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),K=({hoursDone:i,hoursRequired:l})=>{const m=o.useMemo(()=>l<=0?0:Math.min(100,Math.round(i/l*1e3)/10),[i,l]);return e.jsxs("div",{style:{background:"#2b2b2b",padding:14,borderRadius:10},children:[e.jsx("div",{style:{width:"100%",background:"rgba(0,0,0,0.25)",height:36,borderRadius:10,overflow:"hidden"},children:e.jsx("div",{style:{width:`${m}%`,height:"100%",background:"linear-gradient(90deg,#ff66cc 0%,#b400ff 50%,#7b2cff 100%)",transition:"width 700ms ease"}})}),e.jsxs("div",{style:{textAlign:"center",marginTop:10,color:"#ddd",fontSize:14},children:[i," / ",l," ",l===1?"hora":"horas"," (",m,"%)"]})]})},Q=()=>{const[i,l]=o.useState(null),[m,x]=o.useState(!0),[M,b]=o.useState(null),[f,O]=o.useState(()=>{const s=localStorage.getItem("streamer_hours_required"),n=s?Number(s):20;return Number.isNaN(n)||n<=0?20:n}),[$,T]=o.useState(()=>{const s=localStorage.getItem("viewer_points_required"),n=s?Number(s):100;return Number.isNaN(n)||n<=0?100:n}),[y,R]=o.useState(null),[z,a]=o.useState(!1);o.useEffect(()=>{const s=localStorage.getItem("usuario");if(!s){b("No se encontrÃ³ usuario en sesiÃ³n"),x(!1);return}let n;try{n=JSON.parse(s)}catch{b("Error leyendo datos de usuario"),x(!1);return}const p=n.id_usuario??n.id;if(!p){b("No se encontrÃ³ id de streamer"),x(!1);return}(async()=>{try{x(!0),b(null);const g=await fetch(`${u}/streamers/perfil/${p}`);if(g.status===404){l({id_usuario:p,horas_transmitidas_total:0,nivel:null}),x(!1);return}if(!g.ok){b("No se pudo cargar el perfil del streamer"),x(!1);return}const S=await g.json();l(S)}catch{b("Error de conexiÃ³n al cargar el perfil")}finally{x(!1)}})()},[]);const v=i?.horas_transmitidas_total??0,j=o.useMemo(()=>v/60,[v]),h=o.useMemo(()=>i?.nivel?.orden?i.nivel.orden:f<=0?1:Math.floor(j/f)+1,[i,j,f]);o.useEffect(()=>{if(h!=null){if(y===null){R(h);return}h>y&&(a(!0),c.success(`ðŸŽ‰ Â¡Has subido al nivel ${h} como streamer!`)),h!==y&&R(h)}},[h,y]);const _=s=>{s<=0||(O(s),localStorage.setItem("streamer_hours_required",String(s)))},N=async s=>{if(s<=0)return;T(s),localStorage.setItem("viewer_points_required",String(s));const n=localStorage.getItem("usuario");let p=null;try{p=n?JSON.parse(n):null}catch{p=null}const E=p?.id_usuario??p?.id;if(!E)return;const g=localStorage.getItem("authToken");try{await fetch(`${u}/niveles/espectador/base/${E}`,{method:"PUT",headers:{"Content-Type":"application/json",...g?{Authorization:`Bearer ${g}`}:{}},body:JSON.stringify({base:s})})}catch(S){console.error("Error actualizando puntos requeridos de espectadores:",S)}};return e.jsxs("div",{className:"max-w-3xl mx-auto bg-card rounded-2xl p-6 mb-8 shadow-lg border border-border/60",children:[e.jsxs("h2",{className:"text-xl md:text-2xl font-bold mb-4 flex items-center gap-2",children:[e.jsx("span",{className:"inline-flex w-8 h-8 items-center justify-center rounded-full bg-primary/10",children:"ðŸŽ¥"}),"Mi progreso como Streamer"]}),e.jsxs("div",{className:"bg-black/30 rounded-xl px-4 py-3 mb-6 border border-white/5",children:[e.jsxs("div",{className:"flex flex-col gap-5",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-semibold flex items-center gap-2",children:"â³ Horas requeridas por nivel (Streamer):"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-2 py-1 bg-muted rounded hover:bg-muted/80 text-lg font-bold",onClick:()=>_(Math.max(1,f-1)),children:"â€“"}),e.jsx("div",{className:"min-w-[40px] text-center font-semibold",children:f}),e.jsx("button",{className:"px-2 py-1 bg-muted rounded hover:bg-muted/80 text-lg font-bold",onClick:()=>_(f+1),children:"+"})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-semibold flex items-center gap-2",children:"ðŸŽ Puntos requeridos por nivel (Espectadores):"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{className:"px-2 py-1 bg-muted rounded hover:bg-muted/80 text-lg font-bold",onClick:()=>N(Math.max(10,$-10)),children:"â€“"}),e.jsx("div",{className:"min-w-[50px] text-center font-semibold",children:$}),e.jsx("button",{className:"px-2 py-1 bg-muted rounded hover:bg-muted/80 text-lg font-bold",onClick:()=>N($+10),children:"+"})]})]})]}),e.jsx("p",{className:"mt-3 text-xs text-muted-foreground",children:"Ajusta cuÃ¡ntas horas necesitas para subir de nivel como streamer, y cuÃ¡ntos puntos necesitan tus espectadores para subir dentro de tu canal."})]}),m?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Cargando progreso..."}):M?e.jsx("p",{className:"text-sm text-red-400",children:M}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center mb-3 text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Nivel actual:"})," ",e.jsx("span",{className:"font-bold text-primary",children:h})]}),e.jsx(K,{hoursDone:j,hoursRequired:f}),e.jsx("p",{className:"mt-3 text-center text-xs text-muted-foreground",children:"Sigue haciendo lives para subir de nivel ðŸ’ª"}),z&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60",children:e.jsxs("div",{className:"bg-zinc-900 rounded-2xl px-6 py-5 text-center shadow-xl max-w-sm w-full border border-purple-500/40",children:[e.jsxs("h3",{className:"text-2xl font-bold mb-2 text-purple-400",children:["Â¡Nivel ",h," alcanzado! ðŸŽ‰"]}),e.jsx("p",{className:"text-sm text-zinc-200 mb-4",children:"Sigue transmitiendo para desbloquear mÃ¡s beneficios."}),e.jsx(C,{onClick:()=>a(!1),className:"w-full",children:"Seguir streameando"})]})})]})]})},X=({open:i,message:l,onClose:m})=>i?e.jsxs("div",{style:{position:"fixed",inset:0,zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("div",{onClick:m,style:{position:"absolute",inset:0,background:"rgba(0,0,0,0.6)"}}),e.jsxs("div",{style:{position:"relative",background:"rgba(20,20,20,0.98)",color:"#fff",padding:"32px 36px",borderRadius:16,boxShadow:"0 0 40px rgba(204, 102, 255, 0.45)",textAlign:"center",maxWidth:420,width:"90%",border:"1px solid rgba(150,80,200,0.25)"},children:[e.jsx("h2",{style:{marginBottom:12,fontSize:22},children:"ðŸŽ‰ Â¡Felicidades! ðŸŽ‰"}),e.jsx("p",{style:{marginBottom:18,fontSize:16},children:l}),e.jsx("button",{onClick:m,style:{marginTop:6,background:"linear-gradient(90deg,#ff66cc,#7b2cff)",border:"none",color:"#fff",padding:"10px 20px",borderRadius:999,cursor:"pointer",fontWeight:700},children:"Â¡Genial!"})]})]}):null,w=(i={})=>{const l=localStorage.getItem("authToken"),m={...i};return l&&(m.Authorization=`Bearer ${l}`),m},oe=()=>{const i=B(),[l,m]=o.useState("monetizacion"),[x,M]=o.useState([]),[b,f]=o.useState(!0),[O,$]=o.useState(!1),[T,y]=o.useState(!1),[R,z]=o.useState(""),[a,v]=o.useState({nombre:"",costo:"",puntos:""}),[j,h]=o.useState(null),_=localStorage.getItem("usuario");let N=null;try{N=_?JSON.parse(_):null}catch{N=null}const s=N?.id_usuario??N?.id,[n,p]=o.useState(0),[E,g]=o.useState(0);o.useEffect(()=>{if(!s)return;(async()=>{try{const r=await fetch(`${u}/streamers/perfil/${s}`,{headers:w()});if(!r.ok){console.warn("No se encontrÃ³ perfil streamer");return}const k=(await r.json()).horas_transmitidas_total??0;p(Math.floor(k/60)),g(k%60)}catch(r){console.error("Error obteniendo horas transmitidas:",r)}})()},[s]),o.useEffect(()=>{if(!s)return;const t=J(u,{autoConnect:!0});return t.on("connect",()=>{console.log("Socket conectado (frontend Studio):",t.id),t.emit("join_streamer_room",s)}),t.on("gift_received",r=>{const d={type:"gift",from:r.espectador_nombre||r.id_espectador,giftName:r.regalo?.nombre||r.id_regalo||"Regalo",points:r.puntos_otorgados||r.puntos||0,multiplier:r.cantidad||1};window.dispatchEvent(new CustomEvent("tistos:overlay",{detail:d}))}),t.on("level:up",r=>{const d=r?.nivel||`Nivel ${r?.orden}`;z(`Â¡Has subido al ${d} como streamer! ðŸŽ‰`),y(!0)}),t.on("disconnect",()=>{console.log("Socket desconectado (frontend Studio)")}),()=>{t.disconnect()}},[s]),o.useEffect(()=>{const t=localStorage.getItem("authToken");if(!t)return;(async()=>{try{const d=await fetch(`${u}/notificaciones?tipo=NIVEL_STREAMER_SUBIDO&soloNoLeidas=true`,{headers:{Authorization:`Bearer ${t}`}});if(!d.ok)return;const k=await d.json();if(!Array.isArray(k)||k.length===0)return;const I=k[0],Y=I.mensaje||"Â¡Has subido de nivel como streamer! ðŸŽ‰";I.id_notificacion&&await fetch(`${u}/notificaciones/${I.id_notificacion}/leida`,{method:"PUT",headers:{Authorization:`Bearer ${t}`}})}catch(d){console.error("Error consultando notificaciones de nivel:",d)}})()},[]);const S=async t=>{try{const r=await fetch(`${u}/usuarios/${t}/rol`,{method:"PUT",headers:w({"Content-Type":"application/json"}),body:JSON.stringify({rol:"STREAMER"})});if(r.ok){const d=await r.json();localStorage.setItem("usuario",JSON.stringify(d)),localStorage.setItem("tistos_current_user",JSON.stringify(d)),c.success("Modo streamer activado")}else c.error("No se pudo activar modo streamer")}catch(r){console.error(r),c.error("Error al activar modo streamer")}},P=async t=>{try{f(!0);const r=await fetch(`${u}/regalos/streamer/${t}`,{headers:w()});r.ok&&M(await r.json())}catch{c.error("Error cargando regalos")}finally{f(!1)}};o.useEffect(()=>{(async()=>{if(!s)return;const r=await fetch(`${u}/usuarios/${s}`,{headers:w()});r.ok?(await r.json()).rol!=="STREAMER"&&await S(s):await S(s),await P(s)})()},[s]);const L=async t=>{if(t.preventDefault(),!a.nombre||!a.costo||!a.puntos){c.error("Todos los campos son obligatorios");return}try{j?(await fetch(`${u}/regalos/${j}`,{method:"PUT",headers:w({"Content-Type":"application/json"}),body:JSON.stringify({nombre:a.nombre,costo_monedas:Number(a.costo),puntos_otorgados:Number(a.puntos)})})).ok?c.success("Regalo actualizado"):c.error("Error al actualizar regalo"):(await fetch(`${u}/regalos/crear`,{method:"POST",headers:w({"Content-Type":"application/json"}),body:JSON.stringify({id_streamer:s,nombre:a.nombre,costo_monedas:Number(a.costo),puntos_otorgados:Number(a.puntos)})})).ok?c.success("Regalo creado"):c.error("Error al crear regalo"),v({nombre:"",costo:"",puntos:""}),s&&await P(s)}catch{c.error("Error al guardar regalo")}},H=async t=>{try{(await fetch(`${u}/regalos/${t}`,{method:"DELETE",headers:w()})).ok?(c.success("Regalo eliminado"),s&&P(s)):c.error("Error al eliminar regalo")}catch{c.error("Error al eliminar")}},q=t=>{h(t.id_regalo),v({nombre:t.nombre,costo:String(t.costo_monedas),puntos:String(t.puntos_otorgados)})};return e.jsxs("div",{className:"min-h-screen bg-background relative pb-20",children:[e.jsx(X,{open:T,message:R,onClose:()=>y(!1)}),e.jsx(C,{variant:"ghost",size:"icon",className:"absolute top-4 left-4",onClick:()=>i(-1),children:e.jsx(D,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-3xl font-bold text-center pt-8 mb-6",children:"Tistos Studio"}),e.jsx(V,{}),e.jsx(Q,{}),e.jsxs("div",{className:"max-w-xl mx-auto bg-card rounded-xl p-6 mb-6 shadow flex flex-col gap-2",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("span",{className:"font-bold text-lg",children:"EstadÃ­sticas"})}),e.jsx("div",{className:"grid grid-cols-3 gap-4 ",children:e.jsxs("div",{children:[e.jsxs("span",{className:"font-bold text-xl",children:[n,"h ",E,"m"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Horas transmitidas"})]})})]}),e.jsxs("div",{className:"max-w-xl mx-auto bg-card rounded-xl p-6 mb-8",children:[e.jsxs("h3",{className:"font-bold mb-4 flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5 text-primary"})," Regalos del canal"]}),e.jsxs("form",{onSubmit:L,className:"flex gap-2 mb-4",children:[e.jsx("input",{type:"text",placeholder:"Nombre",className:"border rounded px-2 py-1 bg-background text-foreground",value:a.nombre,onChange:t=>v({...a,nombre:t.target.value})}),e.jsx("input",{type:"number",placeholder:"Costo",className:"border rounded px-2 py-1 w-20 bg-background text-foreground",value:a.costo,onChange:t=>v({...a,costo:t.target.value})}),e.jsx("input",{type:"number",placeholder:"Puntos",className:"border rounded px-2 py-1 w-20 bg-background text-foreground",value:a.puntos,onChange:t=>v({...a,puntos:t.target.value})}),e.jsx(C,{type:"submit",size:"sm",variant:"secondary",children:j?e.jsx(U,{className:"w-4 h-4"}):e.jsx(G,{className:"w-4 h-4"})})]}),b?e.jsx("p",{children:"Cargando..."}):x.length===0?e.jsx("p",{children:"No hay regalos creados."}):x.map(t=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-semibold",children:t.nombre}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Costo: ",t.costo_monedas]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Puntos: ",t.puntos_otorgados]}),e.jsx(C,{size:"icon",variant:"ghost",onClick:()=>q(t),children:e.jsx(U,{className:"w-4 h-4"})}),e.jsx(C,{size:"icon",variant:"ghost",onClick:()=>H(t.id_regalo),children:e.jsx(W,{className:"w-4 h-4 text-red-500"})})]},t.id_regalo))]})]})};export{oe as default};
