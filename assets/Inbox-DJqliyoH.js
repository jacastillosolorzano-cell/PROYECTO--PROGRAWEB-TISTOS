import{e as S,r as n,j as e,X as $,a as R,B as v}from"./index-Bd_cwXdb.js";import{B as E}from"./button-DzR6liC0.js";import{S as z,M as I,B as T}from"./BottomNav-BodfrMBM.js";import{S as _}from"./star-CenmtJ9I.js";import{H as q}from"./HeaderSaldo-DhCQ9v_o.js";import{A as D}from"./arrow-left-DFWmSMtC.js";import"./coins-DZF2Q1N-.js";const H=S("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);const K=S("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),P=({searchOpen:r,setSearchOpen:i,searchQuery:a,setSearchQuery:l,onEnter:u,filteredChats:c=[]})=>{const m=n.useRef(null);return n.useEffect(()=>{r&&m.current?.focus()},[r]),n.useEffect(()=>{const o=h=>{h.key==="Escape"&&r&&(i(!1),l(""))};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[r,i,l]),e.jsxs("div",{className:"flex-none",children:[e.jsx(E,{variant:"ghost",size:"icon",onClick:()=>{const o=!r;i(o),o&&setTimeout(()=>m.current?.focus(),50)},children:e.jsx(z,{className:"w-5 h-5"})}),r&&e.jsx("div",{className:"absolute top-16 left-4 right-4 z-10 bg-card p-2 rounded-md shadow-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{ref:m,value:a,onChange:o=>l(o.target.value),placeholder:"Buscar chats o mensajes...",className:"w-full px-3 py-2 rounded-md bg-background text-white outline-none",onKeyDown:o=>{o.key==="Enter"&&c.length===1&&u&&u(c)}}),e.jsx("button",{onClick:()=>{i(!1),l("")},className:"p-2 rounded-md bg-transparent","aria-label":"Cerrar búsqueda",children:e.jsx($,{className:"w-4 h-4 text-muted-foreground"})})]})})]})},U=({chats:r,onChatClick:i})=>e.jsxs("div",{children:[r.map(a=>e.jsxs("div",{className:"flex items-center gap-3 py-2 border-b border-border cursor-pointer hover:bg-muted rounded p-2",onClick:()=>i(a),children:[a.avatar?e.jsx("img",{src:a.avatar,alt:a.nombre,className:"w-10 h-10 rounded-full"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-secondary flex items-center justify-center text-white text-sm font-bold",children:a.nombre.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"font-semibold text-sm flex items-center gap-1",children:[a.nombre,typeof a.level=="number"&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:["· Nivel ",a.level]}),e.jsx(_,{className:"w-3 h-3 text-yellow-500"})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:a.mensaje})]}),e.jsx(I,{className:"w-5 h-5 text-muted-foreground"})]},a.id)),r.length===0&&e.jsx("div",{className:"py-8 text-center text-muted-foreground",children:"No se encontraron conversaciones."})]}),C=["https://api.dicebear.com/7.x/avataaars/svg?seed=Felix","https://api.dicebear.com/7.x/avataaars/svg?seed=Aneka","https://api.dicebear.com/7.x/avataaars/svg?seed=Simba","https://api.dicebear.com/7.x/avataaars/svg?seed=Jazmin","https://api.dicebear.com/7.x/avataaars/svg?seed=Robert","https://api.dicebear.com/7.x/avataaars/svg?seed=George","https://api.dicebear.com/7.x/avataaars/svg?seed=Willow"],Z=()=>{const r=R(),[i,a]=n.useState(""),[l,u]=n.useState(!1),[c,m]=n.useState([]),[o,h]=n.useState(!1),[f,b]=n.useState([]),[N,w]=n.useState(!1),j=n.useMemo(()=>{const s=i.trim().toLowerCase();return s?c.filter(t=>t.nombre.toLowerCase().includes(s)||t.mensaje.toLowerCase().includes(s)):c},[i,c]),y=n.useMemo(()=>f.filter(s=>!s.leido).length,[f]),k=s=>{r(`/chat/${s.id}`,{state:{chat:s}})},L=s=>{const t=s[0];t&&r(`/chat/${t.id}`,{state:{chat:t}})};n.useEffect(()=>{(async()=>{try{const t=localStorage.getItem("usuario");if(!t)return;const x=JSON.parse(t);h(!0);const d=await fetch(`${v}/chats/lista/${x.id_usuario}`);if(d.ok){const B=(await d.json()).map((g,M)=>({id:g.id,nombre:g.nombre,mensaje:g.mensaje,level:g.level,avatar:C[M%C.length]}));m(B)}else console.warn("Error al cargar chats")}catch(t){console.error("Error fetching chats:",t)}finally{h(!1)}})()},[]),n.useEffect(()=>{(async()=>{try{const t=localStorage.getItem("authToken");if(!t)return;w(!0);const x=await fetch(`${v}/notificaciones`,{headers:{Authorization:`Bearer ${t}`}});if(x.ok){const d=await x.json();b(d)}}catch(t){console.error("Error obteniendo notificaciones:",t)}finally{w(!1)}})()},[]);const A=async s=>{try{const t=localStorage.getItem("authToken");if(!t)return;(await fetch(`${v}/notificaciones/${s}/leido`,{method:"POST",headers:{Authorization:`Bearer ${t}`}})).ok&&b(d=>d.map(p=>p.id_notificacion===s?{...p,leido:!0}:p))}catch(t){console.error("Error marcando notificación:",t)}};return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col pb-20",children:[e.jsxs("div",{className:"flex items-center gap-2 p-4",children:[e.jsx(E,{variant:"ghost",size:"icon",onClick:()=>r(-1),children:e.jsx(D,{className:"w-5 h-5"})}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:l?null:e.jsx("div",{className:"flex items-center gap-4",children:e.jsx("h2",{className:"text-2xl font-bold",children:"Mensajes"})})}),e.jsx(P,{searchOpen:l,setSearchOpen:u,searchQuery:i,setSearchQuery:a,onEnter:L,filteredChats:j})]}),e.jsx(q,{}),e.jsxs("div",{className:"px-6 space-y-4",children:[e.jsxs("div",{className:"flex gap-4 mb-2 overflow-x-auto pb-2 scrollbar-hide",children:[e.jsxs("div",{className:"flex flex-col items-center min-w-[56px] cursor-pointer opacity-80 hover:opacity-100 transition-opacity",children:[e.jsxs("div",{className:"w-14 h-14 rounded-full bg-secondary flex items-center justify-center text-white relative",children:[e.jsx(K,{className:"w-6 h-6"}),e.jsx("div",{className:"absolute bottom-0 right-0 bg-primary w-4 h-4 rounded-full border-2 border-background flex items-center justify-center text-[10px] text-white",children:"+"})]}),e.jsx("span",{className:"text-xs mt-1 truncate w-14 text-center",children:"Crear"})]}),c.map(s=>e.jsxs("div",{className:"flex flex-col items-center min-w-[56px] cursor-pointer hover:scale-105 transition-transform",onClick:()=>k(s),children:[s.avatar?e.jsx("img",{src:s.avatar,alt:s.nombre,className:"w-14 h-14 rounded-full border-2 border-primary object-cover"}):e.jsx("div",{className:"w-14 h-14 rounded-full bg-muted flex items-center justify-center text-xs font-bold border-2 border-primary",children:s.nombre.substring(0,2).toUpperCase()}),e.jsxs("span",{className:"text-xs mt-1 truncate w-14 text-center text-muted-foreground",children:[s.nombre.split(" ")[0]," "]})]},s.id)),o&&c.length===0&&e.jsx("div",{className:"flex items-center justify-center min-w-[56px] h-14",children:e.jsx("span",{className:"text-xs text-muted-foreground animate-pulse",children:"..."})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"w-5 h-5 text-pink-500"}),y>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-[10px] rounded-full px-1",children:y})]}),e.jsx("span",{className:"font-semibold",children:"Actividad"})]}),e.jsxs("div",{className:"space-y-2 mt-2",children:[!N&&f.length===0&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"No tienes actividad reciente."}),!N&&f.map(s=>e.jsxs("div",{className:`p-3 rounded-lg bg-card border flex items-start justify-between gap-3 ${s.leido?"border-border":"border-primary"}`,children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm",children:s.mensaje}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-1",children:new Date(s.fecha_hora).toLocaleString()})]}),!s.leido&&e.jsx("button",{className:"text-xs text-primary underline",onClick:()=>A(s.id_notificacion),children:"Leída"})]},s.id_notificacion))]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("h3",{className:"font-bold mb-2",children:"Chats Recientes"}),o?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Cargando..."}):j.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aún no sigues a ningún streamer o no has interactuado."}):e.jsx(U,{chats:j,onChatClick:k})]})]}),e.jsx("div",{className:"mt-auto",children:e.jsx(T,{})})]})};export{Z as default};
