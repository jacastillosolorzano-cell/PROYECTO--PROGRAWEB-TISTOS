import{e as h,a as U,r as o,u as V,j as e,B as S,f as k,g as J,h as Z,i as K,L as W}from"./index-Bd_cwXdb.js";import{B as d}from"./button-DzR6liC0.js";import{B as F}from"./BottomNav-BodfrMBM.js";import{H as Q}from"./HeaderSaldo-DhCQ9v_o.js";import{A as X}from"./arrow-left-DFWmSMtC.js";import{S as Y}from"./star-CenmtJ9I.js";import"./coins-DZF2Q1N-.js";const ee=h("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);const se=h("Gem",[["path",{d:"M6 3h12l4 6-10 13L2 9Z",key:"1pcd5k"}],["path",{d:"M11 3 8 9l4 13 4-13-3-6",key:"1fcu3u"}],["path",{d:"M2 9h20",key:"16fsjt"}]]);const te=h("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);const ae=h("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);const I=h("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);const re=h("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]);const ne=h("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),oe=()=>{const l=U(),[t,i]=o.useState(!1),{setSaldo:r}=V(),n=async()=>{if(!t){i(!0);try{const s=localStorage.getItem("authToken");await fetch(`${S}/auth/logout`,{method:"POST",headers:{"Content-Type":"application/json",...s?{Authorization:`Bearer ${s}`}:{}}}),localStorage.removeItem("authToken"),localStorage.removeItem("usuario"),r(0),l("/login")}catch(s){console.error("Error al cerrar sesión:",s)}finally{i(!1)}}};return e.jsxs(d,{variant:"ghost",onClick:n,disabled:t,className:"justify-start w-full px-6 py-4 text-left text-red-500 hover:text-red-400 hover:bg-red-500/10",children:[e.jsx(te,{className:"w-5 h-5 mr-2"}),t?"Cerrando sesión...":"Cerrar sesión"]})},le=l=>{const[t,i]=o.useState(()=>{const s=localStorage.getItem("currentUser");if(s){const a=JSON.parse(s);return{id:a.id||"1",name:a.name||"Usuario Invitado",points:a.points||0,level:k(a.points||0),...l}}return{id:"1",name:"Usuario Invitado",points:0,level:1,...l}});o.useEffect(()=>{localStorage.setItem("currentUser",JSON.stringify(t))},[t]);const r=s=>{const a=t.points,c=J(a,s),u=k(c),x=u>t.level;return i({...t,points:c,level:u}),{didLevelUp:x,newLevel:u}},n=s=>{const a={...t,...s,level:k(s.points||t.points)};i(a)};return o.useEffect(()=>{let s;return t.name!=="Usuario Invitado"&&(s=setInterval(()=>{r("watchVideo")},1e4)),()=>clearInterval(s)},[t.name]),{user:t,updatePoints:r,setCurrentUser:n}};function ie({userId:l}){const[t,i]=o.useState([]);return o.useEffect(()=>{if(!l)return;let r=!0;return(async()=>{try{const n=await fetch(`${S}/usuarios/${l}/progreso`);if(!n.ok){console.warn("No se pudo obtener progreso desde backend",await n.text());return}const s=await n.json();if(!r)return;i(s||[])}catch(n){console.error("Error al obtener progreso:",n)}})(),()=>{r=!1}},[l]),!t||t.length===0?null:e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-semibold mb-2",children:"Progreso por canal"}),e.jsx("div",{className:"space-y-3",children:t.map(r=>{const n=r.nivel,s=r.streamer,a=r.puntos_actuales||0,c=n?.puntos_requeridos??1e3,u=Math.max(c-a,0),x=Math.min(Math.round(a/c*100),100);return e.jsxs("div",{className:"bg-muted p-3 rounded",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1",children:[e.jsx("div",{className:"font-medium",children:s?.nombre||s?.id_usuario||"Streamer"}),e.jsxs("div",{className:"text-muted-foreground",children:[a," / ",c]})]}),e.jsx("div",{className:"w-full bg-black/10 rounded-full h-2 mb-1",children:e.jsx("div",{className:"bg-gradient-to-r from-green-400 to-blue-500 h-2 rounded-full",style:{width:`${x}%`}})}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Faltan ",u,' puntos para "',n?.nombre_nivel||"siguiente nivel",'"']})]},r.id_progreso)})})]})}const ge=()=>{const l=U(),[t,i]=o.useState(!1),{user:r}=le(),{toast:n}=Z(),s=localStorage.getItem("usuario"),a=s?JSON.parse(s):null,c={avatar:"https://is1-ssl.mzstatic.com/image/thumb/Purple211/v4/af/ba/26/afba2629-ac1e-01c3-dce7-293a45a2bc48/AppIcon-0-1x_U007epad-0-1-0-85-220-0.png/230x0w.webp",seguidores:999,seguidos:999,meGusta:999},u=a?.nombre??r?.name??"ulima123",x=`profile_description_${u}`,[f,P]=o.useState(""),[A,N]=o.useState(!1),[M,b]=o.useState("");o.useEffect(()=>{const m=localStorage.getItem(x);m&&P(m)},[x]);const q=()=>{b(f),N(!0)},B=()=>{const m=M.trim();P(m),localStorage.setItem(x,m),N(!1),n({title:"Descripción guardada",description:m?"Tu descripción se actualizó correctamente.":"Descripción eliminada.",duration:2500})},_=()=>{b(""),N(!1)},[p,C]=o.useState(null),[R,z]=o.useState(!1);o.useEffect(()=>{(async()=>{if(a?.id_usuario)try{z(!0);const v=await fetch(`${S}/usuarios/${a.id_usuario}/progreso`);if(!v.ok){console.warn("No se pudo cargar progreso general");return}const w=await v.json();if(!w||w.length===0){C(null);return}const g=w.reduce((E,L)=>(L.puntos_actuales||0)>(E.puntos_actuales||0)?L:E),T=g.puntos_actuales||0,O=g.nivel?.puntos_requeridos??1e3,G=g.nivel?.nombre_nivel??"Nuevo",H=g.streamer?.nombre||g.streamer?.id_usuario;C({puntos:T,puntosRequeridos:O,nivelNombre:G,streamerNombre:H})}catch(v){console.error("Error cargando progreso general:",v)}finally{z(!1)}})()},[a?.id_usuario]);const j=p?.puntos??0,y=p?.puntosRequeridos??1e3,$=Math.max(y-j,0),D=Math.min(Math.round(j/y*100),100);return e.jsxs("div",{className:"min-h-screen bg-background relative flex flex-col",children:[e.jsx(d,{variant:"ghost",size:"icon",className:"absolute top-4 left-4 z-10",onClick:()=>l(-1),children:e.jsx(X,{className:"w-5 h-5"})}),e.jsx(Q,{}),e.jsx(d,{variant:"ghost",size:"icon",className:"absolute top-4 right-4 z-10",onClick:()=>i(!t),children:e.jsx(ae,{className:"w-6 h-6"})}),t&&e.jsxs("div",{className:"fixed top-0 right-0 h-full w-56 bg-card shadow-lg z-20 flex flex-col pt-16 animate-slide-in",children:[e.jsxs(d,{variant:"ghost",className:"justify-start w-full px-6 py-4 text-left",onClick:()=>{i(!1),l("/saldo")},children:[e.jsx(re,{className:"w-5 h-5 mr-2"}),"Ver saldo"]}),e.jsx(oe,{}),e.jsxs(d,{variant:"ghost",className:"justify-start w-full px-6 py-4 text-left",onClick:()=>i(!1),children:[e.jsx(ee,{className:"w-5 h-5 mr-2"}),"Volver a perfil"]})]}),e.jsxs("div",{className:"flex flex-col items-center pt-16 pb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:c.avatar,alt:"avatar",className:"w-24 h-24 rounded-full border-4 border-white shadow-lg"}),e.jsx(d,{variant:"secondary",size:"icon",className:"absolute bottom-0 right-0 rounded-full",title:"Agregar foto",children:e.jsx(I,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"mt-2 text-lg font-semibold",children:["@",u]}),a?.email&&e.jsx("div",{className:"text-xs text-muted-foreground",children:a.email}),f?e.jsx("p",{className:"mt-2 text-center max-w-xl text-sm text-muted-foreground px-4",children:f}):null,e.jsx("div",{className:"mt-3",children:e.jsx(d,{variant:"outline",size:"sm",onClick:q,children:f?"Editar descripción":"+ Agregar descripción"})})]}),e.jsxs("div",{className:"flex justify-center gap-8 mb-4",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-bold",children:c.seguidos}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Siguiendo"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-bold",children:c.seguidores}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Seguidores"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"font-bold",children:c.meGusta}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Me gusta"})]})]}),e.jsxs("div",{className:"mx-4 mb-4 bg-card rounded-lg p-4 shadow-sm border",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-3 flex items-center gap-2",children:[e.jsx(ne,{className:"w-5 h-5 text-yellow-500"}),"Mi Progreso"]}),R?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Cargando progreso..."}):p?e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx("strong",{children:"Nombre:"})," ",u]}),p.streamerNombre&&e.jsxs("p",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:["Principal en canal: ",p.streamerNombre]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4 text-yellow-500"}),e.jsx("strong",{children:"Nivel:"})," ",p.nivelNombre]}),e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-green-500"}),e.jsx("strong",{children:"Puntos:"})," ",K(j)]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsx("span",{children:"Progreso al siguiente nivel"}),e.jsxs("span",{children:[j," / ",y]})]}),e.jsx("div",{className:"w-full bg-muted rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-green-400 to-blue-500 h-2 rounded-full transition-all duration-300",style:{width:`${D}%`}})}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Próximo nivel en ",$," puntos."]})]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aún no tienes puntos. Participa en chats, envía regalos o juega a la ruleta para empezar a subir de nivel."}),e.jsx(ie,{userId:a?.id_usuario})]}),e.jsx("div",{className:"flex justify-center mb-2",children:e.jsx(d,{asChild:!0,variant:"secondary",children:e.jsx(W,{to:"/studio",children:e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(I,{className:"w-4 h-4"}),"Tistos Studio"]})})})}),A&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:_}),e.jsxs("div",{className:"relative bg-[#151515] p-6 rounded-lg shadow-xl w-[min(720px,92%)] border border-purple-800",children:[e.jsx("h3",{className:"text-lg font-bold mb-3",children:"Editar descripción"}),e.jsx("textarea",{value:M,onChange:m=>b(m.target.value),rows:5,className:"w-full bg-card p-3 rounded-md text-white outline-none",placeholder:"Describe tu canal, horarios, enlaces... (máx 300 caracteres)",maxLength:300}),e.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[e.jsx(d,{variant:"ghost",onClick:_,children:"Cancelar"}),e.jsx(d,{onClick:B,children:"Guardar"})]})]})]}),e.jsx("div",{className:"mt-auto",children:e.jsx(F,{})})]})};export{ge as default};
