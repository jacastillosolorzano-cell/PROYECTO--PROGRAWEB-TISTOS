import{w as p,v as b,r as c,j as s}from"./index-DM_z9rUw.js";import{l as w}from"./index-TjCxX7sJ.js";import{C as g}from"./ComentSection-ZtHB9KYM.js";import"./button-A-3QlY1Z.js";import"./use-user-CDC5hjwT.js";import"./config-9OvXtyrZ.js";const t=w("http://localhost:5002",{transports:["websocket"]}),x=()=>{const{id_sesion:n}=b(),e=c.useRef(null),a=c.useRef(null),[i,m]=c.useState(!1),[d,l]=c.useState(!1);c.useEffect(()=>{if(!n)return;console.log("Viewer entrando al stream:",n),t.emit("join_stream",{streamId:n,role:"viewer"});const o=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});return a.current=o,o.ontrack=r=>{console.log("Track recibido!"),e.current&&(e.current.srcObject=r.streams[0])},t.on("stream-ended",()=>{console.log("ðŸ”´ Stream terminado"),e.current&&(e.current.srcObject=null),a.current&&(a.current.close(),a.current=null),alert("El streamer finalizÃ³ la transmisiÃ³n.")}),t.on("stream-offer",async r=>{if(r.to!==t.id)return;await o.setRemoteDescription(r.offer);const u=await o.createAnswer();await o.setLocalDescription(u),t.emit("stream-answer",{answer:u,to:r.from,from:t.id,streamId:n})}),t.on("ice-candidate",r=>{r.to===t.id&&o.addIceCandidate(new RTCIceCandidate(r.candidate))}),()=>{t.off("stream-offer"),t.off("ice-candidate"),t.off("stream-ended"),o.close(),a.current=null}},[n]);const f=()=>{if(!e.current)return;const o=!i;m(o),o?(e.current.muted=!1,e.current.volume=1,e.current.play().catch(r=>console.log(r))):(e.current.muted=!0,e.current.volume=0)};return s.jsxs("div",{className:"h-screen w-screen bg-black flex items-center justify-center relative",children:[s.jsx("video",{ref:e,autoPlay:!0,playsInline:!0,muted:!i,style:{width:"100%",height:"100%",backgroundColor:"black"}}),s.jsx("button",{onClick:f,className:"absolute bottom-10 right-10 bg-white text-black px-4 py-2 rounded-xl shadow-lg",children:i?"ðŸ”‡ Silenciar":"ðŸ”Š Activar audio"}),s.jsx("button",{onClick:()=>{console.log("Abriendo comentarios, sessionId:",n),l(!0)},className:"absolute bottom-10 left-10 bg-blue-500 text-white px-4 py-2 rounded-xl shadow-lg",children:"ðŸ’¬ Comentarios"}),d&&s.jsxs(s.Fragment,{children:[console.log("Renderizando CommentSection con sessionId:",n),s.jsx(g,{sessionId:n,onClose:()=>l(!1)})]})]})},S=p.memo(x);export{S as default};
