import{y as m,x as f,r as c,j as l}from"./index-D4ZRzdJO.js";import{l as g}from"./index-CA1CrNgP.js";import{a as w}from"./index-B9ygI19o.js";const p="http://localhost:5002",o=g("http://localhost:5002",{transports:["websocket"]}),b=()=>{const{id_sesion:s}=f(),r=c.useRef(null),n=c.useRef(null),[i,u]=c.useState(!1);c.useEffect(()=>{async function t(){if(s)try{const a=(await w.get(`${p}/sesiones/${s}`)).data.id_streamer;a?(localStorage.setItem("id_streamer_actual",a),console.log("âœ” Streamer actual guardado:",a)):console.warn("âš  La sesiÃ³n no tiene streamer asociado")}catch(e){console.error("âŒ Error cargando streamer:",e)}}t()},[s]),c.useEffect(()=>{if(!s)return;console.log("Viewer entrando al stream:",s),o.emit("join_stream",{streamId:s,role:"viewer"});const t=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});return n.current=t,t.ontrack=e=>{console.log("Track recibido!"),r.current&&(r.current.srcObject=e.streams[0])},o.on("stream-ended",()=>{console.log("ðŸ”´ Stream terminado"),r.current&&(r.current.srcObject=null),n.current&&(n.current.close(),n.current=null),alert("El streamer finalizÃ³ la transmisiÃ³n.")}),o.on("stream-offer",async e=>{if(e.to!==o.id)return;await t.setRemoteDescription(e.offer);const a=await t.createAnswer();await t.setLocalDescription(a),o.emit("stream-answer",{answer:a,to:e.from,from:o.id,streamId:s})}),o.on("ice-candidate",e=>{e.to===o.id&&t.addIceCandidate(new RTCIceCandidate(e.candidate))}),()=>{o.off("stream-offer"),o.off("ice-candidate"),o.off("stream-ended"),t.close(),n.current=null}},[s]);const d=()=>{if(!r.current)return;const t=!i;u(t),t?(r.current.muted=!1,r.current.volume=1,r.current.play().catch(e=>console.log(e))):(r.current.muted=!0,r.current.volume=0)};return l.jsxs("div",{className:"h-screen w-screen bg-black flex items-center justify-center relative",children:[l.jsx("video",{ref:r,autoPlay:!0,playsInline:!0,muted:!i,style:{width:"100%",height:"100%",backgroundColor:"black"}}),l.jsx("button",{onClick:d,className:"absolute bottom-10 right-10 bg-white text-black px-4 py-2 rounded-xl shadow-lg",children:i?"ðŸ”‡ Silenciar":"ðŸ”Š Activar audio"})]})},y=m.memo(b);export{y as default};
