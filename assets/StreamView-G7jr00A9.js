import{y as m,x as f,r as a,j as i}from"./index-8KvSQBZQ.js";import{l as w}from"./index-CA1CrNgP.js";const t=w("http://192.168.100.12:5002",{transports:["websocket"]}),p=()=>{const{id_sesion:o}=f(),e=a.useRef(null),s=a.useRef(null),[c,u]=a.useState(!1);a.useEffect(()=>{if(!o)return;console.log("Viewer entrando al stream:",o),t.emit("join_stream",{streamId:o,role:"viewer"});const r=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});return s.current=r,r.ontrack=n=>{console.log("Track recibido!"),e.current&&(e.current.srcObject=n.streams[0])},t.on("stream-ended",()=>{console.log("ðŸ”´ Stream terminado"),e.current&&(e.current.srcObject=null),s.current&&(s.current.close(),s.current=null),alert("El streamer finalizÃ³ la transmisiÃ³n.")}),t.on("stream-offer",async n=>{if(n.to!==t.id)return;await r.setRemoteDescription(n.offer);const l=await r.createAnswer();await r.setLocalDescription(l),t.emit("stream-answer",{answer:l,to:n.from,from:t.id,streamId:o})}),t.on("ice-candidate",n=>{n.to===t.id&&r.addIceCandidate(new RTCIceCandidate(n.candidate))}),()=>{t.off("stream-offer"),t.off("ice-candidate"),t.off("stream-ended"),r.close(),s.current=null}},[o]);const d=()=>{if(!e.current)return;const r=!c;u(r),r?(e.current.muted=!1,e.current.volume=1,e.current.play().catch(n=>console.log(n))):(e.current.muted=!0,e.current.volume=0)};return i.jsxs("div",{className:"h-screen w-screen bg-black flex items-center justify-center relative",children:[i.jsx("video",{ref:e,autoPlay:!0,playsInline:!0,muted:!c,style:{width:"100%",height:"100%",backgroundColor:"black"}}),i.jsx("button",{onClick:d,className:"absolute bottom-10 right-10 bg-white text-black px-4 py-2 rounded-xl shadow-lg",children:c?"ðŸ”‡ Silenciar":"ðŸ”Š Activar audio"})]})},x=m.memo(p);export{x as default};
