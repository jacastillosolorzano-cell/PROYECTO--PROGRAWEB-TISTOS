import{r as s,j as e,i as P,B as k}from"./index-B6pz0rYB.js";import{B as E}from"./button-BxsxkGX6.js";import{D as V,a as z,b as J}from"./dialog-D3VDACmO.js";import{G as C}from"./gift-N5LkDgKW.js";function W({gift:r,visible:n,onClose:d,durationMs:u=3500}){const[c,l]=s.useState(n),t=s.useRef(null);return s.useEffect(()=>{if(l(n),t.current&&(window.clearTimeout(t.current),t.current=null),!!n)return t.current=window.setTimeout(()=>{l(!1),d(),t.current=null},u),()=>{t.current&&(window.clearTimeout(t.current),t.current=null)}},[n,u,d]),s.useEffect(()=>()=>{t.current&&(window.clearTimeout(t.current),t.current=null)},[]),r?e.jsx("div",{className:`fixed right-8 top-20 z-50 pointer-events-auto transform-gpu ${c?"animate-slide-in":"animate-slide-out"}`,onClick:()=>{t.current&&(window.clearTimeout(t.current),t.current=null),l(!1),d()},children:e.jsxs("div",{className:"flex items-center gap-4 bg-gradient-to-r from-pink-500 to-secondary p-4 rounded-2xl shadow-glow text-white min-w-[300px] max-w-md",children:[e.jsx("img",{src:r.imagen,alt:r.nombre,className:"w-20 h-20 object-contain"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-extrabold text-lg",children:"¬°Recibiste un regalo!"}),e.jsx("div",{className:"text-md opacity-95",children:r.nombre})]})]})}):null}const O=[1,1,1,2,2,3],Y=({open:r,gift:n,onClose:d,onResult:u})=>{const[c,l]=s.useState(!1),[t,x]=s.useState(null);s.useEffect(()=>{r||(l(!1),x(null))},[r]);const p=()=>{c||!n||(l(!0),x(null),setTimeout(()=>{const i=Math.floor(Math.random()*O.length),g=O[i];x(g),l(!1),u(g)},1200))};return!r||!n?null:e.jsxs("div",{style:{position:"fixed",inset:0,zIndex:60,display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("div",{onClick:d,style:{position:"absolute",inset:0,background:"rgba(0,0,0,0.6)"}}),e.jsxs("div",{style:{position:"relative",width:360,background:"#151515",borderRadius:12,padding:18,boxShadow:"0 10px 40px rgba(0,0,0,0.6)",border:"1px solid rgba(120,60,160,0.12)",color:"#fff"},children:[e.jsx("h3",{style:{margin:0,marginBottom:8},children:"Mini-juego: multiplicador"}),e.jsxs("p",{style:{marginTop:0,marginBottom:12,color:"#cfc"},children:["Regalo: ",e.jsx("strong",{children:n.nombre})," ‚Äî costo base:"," ",n.costo_monedas," monedas"]}),e.jsx("div",{style:{display:"flex",gap:12,alignItems:"center",justifyContent:"center",marginBottom:12},children:e.jsx("div",{style:{width:120,height:120,borderRadius:999,background:"linear-gradient(90deg,#ff66cc,#7b2cff)",display:"flex",alignItems:"center",justifyContent:"center",color:"#111",fontWeight:800,fontSize:20,transform:c?"rotate(360deg)":"none",transition:"transform 1.2s cubic-bezier(.2,.9,.2,.9)"},children:c?"...":t?`${t}x`:"GIRAR"})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:8},children:[e.jsx("button",{onClick:d,style:{background:"transparent",border:"1px solid rgba(255,255,255,0.06)",color:"#fff",padding:"8px 12px",borderRadius:8,cursor:"pointer"},children:"Cancelar"}),e.jsx("button",{onClick:p,disabled:c,style:{background:"linear-gradient(90deg,#ff66cc,#7b2cff)",border:"none",color:"#fff",padding:"8px 12px",borderRadius:8,cursor:"pointer",fontWeight:700},children:c?"Jugando...":t?"Volver a jugar":"Jugar (Girar)"})]})]})]})},T="/PROYECTO--PROGRAWEB-TISTOS/assets/tomba-BDZHZMqZ.png",Z="/PROYECTO--PROGRAWEB-TISTOS/assets/Dina-ChyTXk3Y.png",H=r=>{const n=r.toLowerCase().trim();return n.includes("tomba")?T:n.includes("dina")?Z:T};function X({streamerId:r}){const{saldo:n,setSaldo:d,refrescarSaldo:u}=P(),[c,l]=s.useState(!1),[t,x]=s.useState("principal"),[p,i]=s.useState(""),[g,G]=s.useState([]),[m,y]=s.useState(null),[_,w]=s.useState(!1),[B,D]=s.useState(null),[I,j]=s.useState(!1);s.useEffect(()=>{(async()=>{if(r)try{const o=await fetch(`${k}/regalos/streamer/${r}`);if(!o.ok){console.warn("No se pudo obtener regalos del streamer",o.status,await o.text());return}const h=await o.json();G(h||[])}catch(o){console.error("Error al cargar regalos:",o)}})()},[r]);const $=async(a,o=1)=>{i("");const h=localStorage.getItem("usuario");if(!h){i("Debes iniciar sesi√≥n para enviar regalos.");return}let v;try{v=JSON.parse(h)}catch(f){console.error("Error parseando usuario:",f),i("Error con los datos de sesi√≥n. Vuelve a iniciar sesi√≥n.");return}const N=v.id_usuario??v.id;if(!N){i("No se encontr√≥ tu ID de usuario. Vuelve a iniciar sesi√≥n.");return}const S=a.costo_monedas*o;if(n<S){i(`No tienes suficientes monedas. Necesitas ${S} monedas.`);return}const R=localStorage.getItem("authToken");try{const f=await fetch(`${k}/regalos/enviar`,{method:"POST",headers:{"Content-Type":"application/json",...R?{Authorization:`Bearer ${R}`}:{}},body:JSON.stringify({id_espectador:N,id_streamer:r,id_regalo:a.id_regalo,cantidad:o})}),b=await f.json();if(!f.ok){console.error("Error /regalos/enviar:",b),i(b.error||"Error al enviar el regalo."),await u();return}typeof b.saldo_monedas=="number"?d(b.saldo_monedas):await u(),D({nombre:o>1?`${a.nombre} x${o}`:a.nombre,imagen:H(a.nombre)}),w(!0),i(o>1?`¬°Regalo enviado con multiplicador x${o}! üéÅ`:"¬°Regalo enviado correctamente! üéÅ")}catch(f){console.error("Error al enviar regalo:",f),i("Error de conexi√≥n al enviar el regalo.")}},A=a=>{y(a),i(""),x("detalle")},M=()=>{x("principal"),y(null),i("")};return e.jsxs("div",{children:[e.jsx("button",{className:"flex items-center gap-2 bg-pink-500 hover:bg-pink-600 text-white font-semibold px-4 py-2 rounded-xl shadow-md transition",onClick:()=>l(!0),title:"Enviar regalo",children:"üéÅ"}),e.jsx(V,{open:c,onOpenChange:l,children:e.jsx(z,{className:"sm:max-w-md",children:e.jsxs(J,{children:[e.jsxs("div",{className:"border-b-2 border-white pb-2 mb-4 flex items-center justify-between",children:[e.jsx("h1",{className:"text-pink-600 text-3xl font-bold",children:"Regalos"}),e.jsxs("div",{className:"text-right",children:[e.jsx("h1",{className:"text-muted-foreground text-xs",children:"Saldo"}),e.jsxs("h1",{className:"text-2xl font-bold",children:[n," MONEDAS"]})]})]}),t==="principal"&&e.jsx("div",{className:"relative flex flex-wrap justify-start items-start gap-4 min-h-[160px]",children:g.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Este streamer a√∫n no tiene regalos configurados."}):g.map(a=>e.jsxs("button",{onClick:()=>A(a),className:"flex flex-col items-center justify-center gap-1 px-3 py-2 rounded-lg bg-card hover:bg-card/80 transition border border-white/10",children:[e.jsx(C,{className:"w-6 h-6 text-pink-500"}),e.jsx("span",{className:"text-xs font-semibold",children:a.nombre}),e.jsxs("span",{className:"text-[11px] text-muted-foreground",children:[a.costo_monedas," monedas"]})]},a.id_regalo))}),p&&e.jsx("div",{className:"max-w-xl mx-auto mt-3 mb-1 text-center text-primary font-semibold text-sm",children:p}),t==="detalle"&&m&&e.jsxs("div",{className:"max-w-md mx-auto bg-card rounded-xl p-6 text-center",children:[e.jsxs("h3",{className:"text-xl font-bold mb-3 flex items-center justify-center gap-2",children:[e.jsx(C,{className:"w-5 h-5 text-primary"})," ",m.nombre]}),e.jsxs("p",{className:"text-sm mb-1",children:["Costo:"," ",e.jsxs("span",{className:"font-semibold",children:[m.costo_monedas," monedas"]})]}),e.jsxs("p",{className:"text-sm mb-4",children:["Puntos:"," ",e.jsx("span",{className:"font-semibold",children:m.puntos_otorgados})]}),e.jsxs("div",{className:"flex flex-col gap-3 mt-4",children:[e.jsx(E,{variant:"secondary",onClick:()=>j(!0),children:"Jugar minijuego y enviar"}),e.jsx(E,{variant:"outline",onClick:M,children:"Volver"})]})]})]})})}),e.jsx(W,{gift:B,visible:_,onClose:()=>w(!1)}),e.jsx(Y,{open:I,gift:m,onClose:()=>j(!1),onResult:async a=>{j(!1),m&&await $(m,a)}})]})}export{X as M};
