import{d as w,r as l,j as e,X as k}from"./index-ByqtMrcU.js";import{B as N}from"./button-so4-oYWo.js";import{u as C}from"./use-user-DDbTypsv.js";import{B as A}from"./config-9OvXtyrZ.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=w("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),I=u=>{const a=Math.floor((Date.now()-u)/1e3);if(a<60)return`${a}s`;const o=Math.floor(a/60);if(o<60)return`${o}m`;const c=Math.floor(o/60);return c<24?`${c}h`:`${Math.floor(c/24)}d`},L=({onClose:u,sessionId:a})=>{const[o,c]=l.useState(""),[i,f]=l.useState([{id:1,text:"Â¡QuÃ© buen video!",user:"user_ana-nivel 8â­",likes:3,createdAt:Date.now()-1e3*60*5},{id:2,text:"La ediciÃ³n estÃ¡ top ðŸ”¥",user:"creador123-nivel 10â­",likes:5,createdAt:Date.now()-1e3*60*60}]);console.log("CommentSection montado con sessionId:",a);const d=220;l.useEffect(()=>{try{const t=localStorage.getItem("comments_demo");t&&f(JSON.parse(t))}catch{}},[]),l.useEffect(()=>{try{localStorage.setItem("comments_demo",JSON.stringify(i))}catch{}},[i]);const h=l.useRef(null),x=l.useRef(null),{user:s,setCurrentUser:g}=C();l.useEffect(()=>{var t;(t=h.current)==null||t.focus()},[]),l.useEffect(()=>{x.current&&(x.current.scrollTop=x.current.scrollHeight)},[i]);const v=()=>{if(o.trim()===""||o.length>d){console.log("Mensaje vacÃ­o o muy largo, no se envÃ­a");return}console.log("handleEnviarMensaje llamado, sessionId:",a),console.log("Enviando mensaje:",o),console.log("sessionId es:",a,"tipo:",typeof a);const t={id:Date.now(),text:o.trim(),user:s!=null&&s.name&&s.name!=="Usuario Invitado"?s.name:"ulima123 - nivel 5 â­",likes:0,createdAt:Date.now()};f(r=>{const n=[...r,t];try{localStorage.setItem("comments_demo",JSON.stringify(n))}catch{}return n}),c(""),(async()=>{var r;try{console.log("INICIO: Intentando enviar mensaje"),console.log("sessionId:",a);const n="test-user-123",p=`${A}/sesiones/${a}/mensajes`;console.log("URL:",p),console.log("Body:",{id_espectador:n,contenido:t.text});const m=await fetch(p,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_espectador:n,contenido:t.text})});if(console.log("Status:",m.status),m.ok){const j=await m.json();console.log("Respuesta exitosa:",j);const y=((r=j.mensaje)==null?void 0:r.puntos_otorgados)||1;g({points:((s==null?void 0:s.points)||0)+y})}else console.error("Error:",m.status,await m.text()),g({points:((s==null?void 0:s.points)||0)+1})}catch(n){console.error("Error en fetch:",n),g({points:((s==null?void 0:s.points)||0)+1})}})()},b=t=>{f(r=>r.map(n=>n.id===t?{...n,likes:n.likes+1}:n))};return e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex justify-center items-end",onClick:u,"aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:"bg-background w-full max-w-2xl h-[75%] rounded-t-2xl grid grid-rows-[auto_1fr_auto] overflow-hidden shadow-xl mb-16",onClick:t=>t.stopPropagation(),children:[e.jsxs("header",{className:"flex items-center justify-between border-b p-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-muted flex items-center justify-center font-bold",children:"A"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold",children:"Comentarios"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[i.length," comentarios"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"text-right mr-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Comentando como"}),e.jsx("div",{className:"text-sm font-medium",children:s!=null&&s.name&&s.name!=="Usuario Invitado"?s.name:"ulima123"})]}),e.jsx(N,{variant:"ghost",size:"icon",onClick:u,"aria-label":"Cerrar",children:e.jsx(k,{className:"w-5 h-5"})})]})]}),e.jsx("div",{ref:x,className:"overflow-y-auto p-4 space-y-3",children:i.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"AÃºn no hay comentarios. Â¡SÃ© el primero!"}):i.map(t=>e.jsxs("div",{className:"flex gap-3 items-start",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-pink-500 to-yellow-400 flex items-center justify-center text-white font-bold",children:t.user.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-sm",children:t.user}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Â· ",I(t.createdAt)]})]}),e.jsx("div",{className:"text-sm mt-1",children:t.text}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-muted-foreground",children:[e.jsxs("button",{onClick:()=>b(t.id),className:"flex items-center gap-1 text-rose-500",children:[e.jsx(E,{className:"w-4 h-4"}),e.jsx("span",{children:t.likes})]}),e.jsx("button",{onClick:()=>{var r;c(`@${t.user} `),(r=h.current)==null||r.focus()},className:"text-muted-foreground",children:"Responder"})]})]})]},t.id))}),e.jsxs("footer",{className:"flex items-center gap-2 border-t p-4 pb-6",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-muted flex items-center justify-center font-bold",children:"J"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("input",{ref:h,type:"text",placeholder:"AÃ±ade un comentario...",value:o,onChange:t=>c(t.target.value),className:"w-full bg-muted border rounded-full px-4 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-primary","aria-label":"AÃ±adir comentario",maxLength:d}),e.jsxs("div",{className:"flex justify-between text-xs mt-1 text-muted-foreground",children:[e.jsxs("span",{className:`${o.length>d?"text-rose-500":""}`,children:[o.length,"/",d]}),e.jsx("span",{className:"text-muted-foreground",children:"Escribe y haz click en Publicar"})]})]}),e.jsx(N,{onClick:()=>{console.log("BOTÃ“N PUBLICAR CLICKEADO"),v()},className:"shrink-0",disabled:o.trim()===""||o.length>d,children:"Publicar"})]})]})})};export{L as C,E as H};
