import{e as w,j as e,r as c,B as p,a as I,b as l}from"./index-DY9U8CCk.js";import{l as L}from"./index-CA1CrNgP.js";import{B as d}from"./button-Ds1YTq8B.js";import{O as H}from"./OverlayAnimator-Dcsy71rO.js";import{A as P}from"./arrow-left-DdnAegiL.js";import{G as E}from"./gift-DykKhqHU.js";const $=w("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);const O=w("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);const W=w("GraduationCap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]);const M=w("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);const U=w("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);const V=w("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]),D=({hoursPerLevel:r,setHoursPerLevel:o})=>{const f=m=>{const a=Math.max(1,Math.min(999,Math.floor(m)||1));o(a)},j=m=>{m.target.blur()};return e.jsxs("div",{style:{background:"#2a2a2a",padding:"14px",borderRadius:"12px",marginBottom:"18px",textAlign:"center",boxShadow:"0 0 12px rgba(255, 102, 204, 0.06)"},children:[e.jsx("h3",{style:{margin:"0 0 10px 0",color:"#e6e6e6",fontSize:15},children:"âš™ï¸ Configurar progresiÃ³n"}),e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:10},children:[e.jsx("label",{style:{fontSize:14,color:"#d0d0d0"},children:"Horas requeridas por nivel:"}),e.jsxs("div",{style:{display:"inline-flex",alignItems:"center",background:"#111",padding:"6px 8px",borderRadius:8,border:"1px solid rgba(255,255,255,0.04)",minWidth:86},children:[e.jsx("input",{type:"number",min:1,max:999,value:r,onChange:m=>f(Number(m.target.value)),onWheel:j,style:{padding:"6px 6px",borderRadius:6,border:"none",background:"transparent",color:"#fff",width:48,textAlign:"center",fontSize:14,outline:"none"}}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",marginLeft:8},children:[e.jsx("button",{onClick:()=>f(r+1),title:"Incrementar",style:{width:22,height:18,padding:0,margin:0,display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",color:"#fff",cursor:"pointer"},children:e.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 5l7 7H5l7-7z"})})}),e.jsx("button",{onClick:()=>f(Math.max(1,r-1)),title:"Decrementar",style:{width:22,height:18,padding:0,margin:0,display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",color:"#fff",cursor:"pointer"},children:e.jsx("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 19l-7-7h14l-7 7z"})})})]})]})]}),e.jsx("p",{style:{marginTop:8,fontSize:12,color:"#9a9a9a"},children:"(Cambia este valor para ajustar la progresiÃ³n)"})]})},G=({hoursDone:r,hoursRequired:o})=>{const n=c.useMemo(()=>o<=0?0:Math.min(100,Math.round(r/o*1e3)/10),[r,o]);return e.jsxs("div",{style:{background:"#2b2b2b",padding:14,borderRadius:10},children:[e.jsx("div",{style:{width:"100%",background:"rgba(0,0,0,0.25)",height:36,borderRadius:10,overflow:"hidden"},children:e.jsx("div",{style:{width:`${n}%`,height:"100%",background:"linear-gradient(90deg,#ff66cc 0%,#b400ff 50%,#7b2cff 100%)",transition:"width 700ms ease"}})}),e.jsxs("div",{style:{textAlign:"center",marginTop:10,color:"#ddd",fontSize:14},children:[r," / ",o," ",o===1?"hora":"horas"," (",n,"%)"]})]})},J=({hoursDone:r,level:o})=>e.jsxs("div",{style:{textAlign:"center",marginBottom:12},children:[e.jsxs("div",{style:{color:"#cfc",fontSize:14},children:["Nivel actual:"," ",e.jsx("strong",{style:{color:"#fff"},children:o})]}),e.jsxs("div",{style:{marginTop:8,fontSize:20,fontWeight:700,background:"linear-gradient(90deg,#ff66cc,#7b2cff)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:["Horas totales transmitidas: ",r]})]}),F=({open:r,level:o,onClose:n})=>r?e.jsxs("div",{style:{position:"fixed",inset:0,zIndex:9999,display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("div",{onClick:n,style:{position:"absolute",inset:0,background:"rgba(0,0,0,0.6)"}}),e.jsxs("div",{style:{position:"relative",background:"rgba(20,20,20,0.98)",color:"#fff",padding:"32px 36px",borderRadius:16,boxShadow:"0 0 40px rgba(204, 102, 255, 0.45)",textAlign:"center",maxWidth:420,width:"90%",border:"1px solid rgba(150,80,200,0.25)"},children:[e.jsx("h2",{style:{marginBottom:12,fontSize:22},children:"ğŸ‰ Â¡Felicidades! ğŸ‰"}),e.jsxs("p",{style:{marginBottom:18,fontSize:16},children:["Has subido al ",e.jsxs("b",{children:["nivel ",o]})]}),e.jsx("button",{onClick:n,style:{marginTop:6,background:"linear-gradient(90deg,#ff66cc,#7b2cff)",border:"none",color:"#fff",padding:"10px 20px",borderRadius:999,cursor:"pointer",fontWeight:700},children:"Â¡Genial!"})]})]}):null,K=3e4,q=()=>{const[r,o]=c.useState(20),[n,N]=c.useState(0),[f,j]=c.useState(!1),m=c.useRef(0);c.useEffect(()=>{const g=async()=>{try{const v=localStorage.getItem("authToken");if(!v){console.warn("No hay authToken, no se puede leer /streamers/perfil");return}const h=await fetch(`${p}/streamers/perfil`,{headers:{Authorization:`Bearer ${v}`}});if(!h.ok){console.warn("No se pudo obtener perfil streamer:",h.status,await h.text());return}const k=await h.json(),u=k.perfil??k,C=(u.horas_transmitidas_total??0)/60;N(C),u.nivel&&typeof u.nivel.horas_por_nivel=="number"&&o(u.nivel.horas_por_nivel)}catch(v){console.error("Error al cargar perfil streamer:",v)}};g();const z=window.setInterval(g,K);return()=>window.clearInterval(z)},[]);const a=Math.max(1,Math.floor(n/Math.max(1,r))+1);c.useEffect(()=>{const g=m.current||Math.max(1,Math.floor(Math.max(0,n-.01)/Math.max(1,r))+1);a>g&&j(!0),m.current=a},[a,n,r]);const b=r>0?n%r:0;return e.jsxs("section",{style:{maxWidth:920,margin:"0 auto",padding:"20px"},children:[e.jsxs("div",{style:{borderRadius:18,padding:28,background:"#151515",boxShadow:"0 0 60px rgba(124,58,237,0.12), inset 0 0 40px rgba(124,58,237,0.04)",border:"1px solid rgba(120,60,160,0.12)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:18},children:[e.jsx("div",{style:{width:36,height:36,borderRadius:8,background:"#222",display:"flex",alignItems:"center",justifyContent:"center"},children:"ğŸ¥"}),e.jsx("h3",{style:{color:"#fff",margin:0,fontSize:20},children:"Mi progreso como Streamer"})]}),e.jsx("div",{style:{marginBottom:12},children:e.jsx(D,{hoursPerLevel:r,setHoursPerLevel:o})}),e.jsx("div",{style:{marginBottom:12},children:e.jsx(J,{hoursDone:n,level:a})}),e.jsx("div",{style:{marginBottom:6},children:e.jsx(G,{hoursDone:b,hoursRequired:r})}),e.jsx("p",{style:{textAlign:"center",marginTop:12,color:"#bdbdbd",fontSize:13},children:"Las horas transmitidas se leen desde el backend (sesiones finalizadas). Sigue haciendo lives para subir de nivel ğŸ’ª"})]}),e.jsx(F,{open:f,level:a,onClose:()=>j(!1)})]})},Q=[{id:1,usuario:"streamer1",texto:"Â¡Bienvenidos al directo! #stream #tistos",vistas:"3.5M",likes:"258.7K",categoria:"Trending",img:"https://picsum.photos/seed/stream1/80/80"},{id:2,usuario:"streamer2",texto:"Hoy hablamos de tecnologÃ­a ğŸš€ #tech",vistas:"6.4M",likes:"446.6K",categoria:"Recommended",img:"https://picsum.photos/seed/stream2/80/80"}],y=(r={})=>{const o=localStorage.getItem("authToken"),n={...r};return o&&(n.Authorization=`Bearer ${o}`),n},re=()=>{const r=I(),[o,n]=c.useState("inspiracion"),[N,f]=c.useState([]),[j,m]=c.useState(!1),[a,b]=c.useState({nombre:"",costo:"",puntos:""}),[g,z]=c.useState(null),[v,h]=c.useState(!0),k=localStorage.getItem("usuario");let u=null;try{u=k?JSON.parse(k):null}catch(t){console.error("Error parseando usuario desde localStorage:",t),u=null}const i=u?.id_usuario??u?.id;console.log("usuarioActual Studio:",u),console.log("id_streamer Studio:",i),c.useEffect(()=>{(async()=>{if(!i){console.warn("No hay id_streamer, no se puede cargar Studio"),l.error("No se encontrÃ³ tu usuario streamer. Vuelve a iniciar sesiÃ³n."),h(!1);return}try{const s=await fetch(`${p}/usuarios/${i}`,{headers:y()});if(s.status===200&&(await s.json()).rol==="STREAMER"){await S(i);return}await C(i),await S(i)}catch(s){console.error("Error validando streamer:",s),l.error("No fue posible verificar el streamer"),h(!1)}})()},[i]),c.useEffect(()=>{if(!i)return;const t=L(p,{autoConnect:!0});return t.on("connect",()=>{console.log("Socket conectado (frontend Studio):",t.id),t.emit("join_streamer_room",i)}),t.on("gift_received",s=>{const x={type:"gift",from:s.espectador_nombre||s.id_espectador,giftName:s.regalo?.nombre||s.id_regalo||"Regalo",points:s.puntos_otorgados||s.puntos||0,multiplier:s.cantidad||1};window.dispatchEvent(new CustomEvent("tistos:overlay",{detail:x}))}),t.on("disconnect",()=>{console.log("Socket desconectado (frontend Studio)")}),()=>{t.disconnect()}},[i]);const C=async t=>{try{const s=await fetch(`${p}/usuarios/${t}/rol`,{method:"PUT",headers:y({"Content-Type":"application/json"}),body:JSON.stringify({rol:"STREAMER"})});if(s.status===200){const x=await s.json();localStorage.setItem("usuario",JSON.stringify(x)),localStorage.setItem("tistos_current_user",JSON.stringify(x)),l.success("Â¡Bienvenido al modo Streamer!")}else console.warn("Error al cambiar al modo streamer, status:",s.status,await s.text()),l.error("Error al cambiar al modo streamer")}catch(s){l.error("Error al cambiar al modo streamer"),console.error(s)}},S=async t=>{try{h(!0);const s=await fetch(`${p}/regalos/streamer/${t}`,{headers:y()});if(s.status===200){const x=await s.json();f(x)}else console.warn("Error al obtener regalos, status:",s.status,await s.text())}catch(s){l.error("Error al cargar los regalos"),console.error(s)}finally{h(!1)}},_=(t,s)=>{m(!0),setTimeout(()=>m(!1),2e3)},R=async t=>{if(t.preventDefault(),!i){l.error("No se encontrÃ³ tu usuario streamer. Vuelve a iniciar sesiÃ³n.");return}if(!a.nombre||!a.costo||!a.puntos){l.error("Completa todos los campos");return}try{if(g){const s=await fetch(`${p}/regalos/${g}`,{method:"PUT",headers:y({"Content-Type":"application/json"}),body:JSON.stringify({nombre:a.nombre,costo_monedas:Number(a.costo),puntos_otorgados:Number(a.puntos)})});s.status===200?(l.success("Regalo actualizado"),z(null),await S(i)):(console.warn("Error al actualizar regalo, status:",s.status,await s.text()),l.error("Error al actualizar el regalo"))}else{const s={nombre:a.nombre,costo_monedas:Number(a.costo),puntos_otorgados:Number(a.puntos),id_streamer:i};console.log("Payload /regalos/crear:",s);const x=await fetch(`${p}/regalos/crear`,{method:"POST",headers:y({"Content-Type":"application/json"}),body:JSON.stringify(s)});if(x.status===200)l.success("Regalo creado"),await S(i);else{const B=await x.text();console.error("Error backend /regalos/crear:",B),l.error("Error al crear el regalo")}}b({nombre:"",costo:"",puntos:""})}catch(s){l.error("Error al guardar el regalo"),console.error(s)}},T=t=>{z(t.id_regalo),b({nombre:t.nombre,costo:t.costo_monedas.toString(),puntos:t.puntos_otorgados.toString()})},A=async t=>{try{const s=await fetch(`${p}/regalos/${t}`,{method:"DELETE",headers:y()});s.status===200?(l.success("Regalo eliminado"),i&&await S(i)):(console.warn("Error al eliminar regalo, status:",s.status,await s.text()),l.error("Error al eliminar el regalo"))}catch(s){l.error("Error al eliminar el regalo"),console.error(s)}};return e.jsxs("div",{className:"min-h-screen bg-background relative pb-20",children:[e.jsx(d,{variant:"ghost",size:"icon",className:"absolute top-4 left-4",onClick:()=>r(-1),children:e.jsx(P,{className:"w-5 h-5"})}),e.jsx("h2",{className:"text-3xl font-bold text-center pt-8 mb-6",children:"Tistos Studio"}),e.jsx(H,{}),e.jsx(q,{}),e.jsxs("div",{className:"max-w-xl mx-auto bg-card rounded-xl p-6 mb-6 shadow flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-bold text-lg",children:"EstadÃ­sticas"}),e.jsx(d,{variant:"link",size:"sm",children:"Ver todo"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-xl",children:"0"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Visualizaciones"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"0% 7d"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-xl",children:"0"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Seguidores netos"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"0% 7d"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold text-xl",children:"0"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Me gusta"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"0% 7d"})]})]})]}),e.jsxs("div",{className:"max-w-xl mx-auto flex justify-between items-center mb-3 gap-2",children:[e.jsxs(d,{variant:"outline",size:"sm",className:"flex-1 gap-2",children:[e.jsx(V,{className:"w-4 h-4"})," Verificar cuenta"]}),e.jsxs(d,{variant:"outline",size:"sm",className:"flex-1 gap-2",children:[e.jsx(W,{className:"w-4 h-4"})," Academia de creadores"]})]}),e.jsx("div",{className:"max-w-xl mx-auto flex justify-between items-center mb-6 gap-2",children:e.jsxs(d,{variant:"outline",size:"sm",className:"flex-1 gap-2",children:[e.jsx(O,{className:"w-4 h-4"})," Promocionar"]})}),e.jsx("div",{className:"max-w-xl mx-auto flex mb-4 gap-2",children:e.jsx(d,{variant:o==="monetizacion"?"secondary":"outline",size:"sm",className:"flex-1",onClick:()=>n("monetizacion"),children:"MonetizaciÃ³n"})}),e.jsxs("div",{className:"max-w-xl mx-auto flex gap-2 mb-6",children:[e.jsx(d,{variant:"outline",size:"sm",children:"Trending"}),e.jsx(d,{variant:"outline",size:"sm",children:"Recommended"})]}),e.jsx("div",{className:"max-w-xl mx-auto mb-8",children:Q.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-3 py-3 border-b border-border",children:[e.jsx("span",{className:"font-bold text-primary",children:s+1}),e.jsx("img",{src:t.img,alt:t.usuario,className:"w-12 h-12 rounded-lg object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-semibold",children:t.texto}),e.jsxs("div",{className:"text-xs text-muted-foreground flex gap-2",children:[e.jsxs("span",{children:["ğŸ‘ï¸ ",t.vistas]}),e.jsxs("span",{children:["â¤ï¸ ",t.likes]})]})]}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>_("Rosa",t.usuario),children:e.jsx(E,{className:"w-5 h-5 text-primary"})})]},t.id))}),e.jsxs("div",{className:"max-w-xl mx-auto bg-card rounded-xl p-6 mb-8",children:[e.jsxs("h3",{className:"font-bold mb-4 flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5 text-primary"})," Regalos del canal"]}),e.jsxs("form",{onSubmit:R,className:"flex gap-2 mb-4",children:[e.jsx("input",{type:"text",placeholder:"Nombre",className:"border rounded w-15 bg-background px-2 py-1",value:a.nombre,onChange:t=>b({...a,nombre:t.target.value})}),e.jsx("input",{type:"number",placeholder:"Costo",className:"border rounded w-12 bg-background px-2 py-1",value:a.costo,onChange:t=>b({...a,costo:t.target.value})}),e.jsx("input",{type:"number",placeholder:"Puntos",className:"border rounded px-2 py-1 w-20 bg-background",value:a.puntos,onChange:t=>b({...a,puntos:t.target.value})}),e.jsx(d,{type:"submit",size:"sm",variant:"secondary",children:g?e.jsx(M,{className:"w-4 h-4"}):e.jsx($,{className:"w-4 h-4"})})]}),e.jsx("div",{children:v?e.jsx("p",{className:"text-muted-foreground",children:"Cargando regalos..."}):N.length===0?e.jsx("p",{className:"text-muted-foreground",children:"No hay regalos. Crea uno para comenzar."}):N.map(t=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-semibold",children:t.nombre}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Costo: ",t.costo_monedas]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Puntos: ",t.puntos_otorgados]}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>T(t),children:e.jsx(M,{className:"w-4 h-4"})}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>A(t.id_regalo),children:e.jsx(U,{className:"w-4 h-4 text-red-500"})})]},t.id_regalo))})]}),j&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 pointer-events-none",children:e.jsxs("div",{className:"bg-primary text-white px-8 py-6 rounded-2xl shadow-lg animate-bounce text-center text-xl font-bold",children:["Â¡Has recibido un regalo!",e.jsx("div",{className:"mt-2 text-base",children:"ğŸ Gracias por tu apoyo"})]})})]})};export{re as default};
