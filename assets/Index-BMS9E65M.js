import{d as y,r as a,j as e,u as U,X as B}from"./index-C3vE6_sk.js";import{B as _}from"./config-9OvXtyrZ.js";import{u as A}from"./use-user-CC4iNdhs.js";import{B as v}from"./button-B5gIpL2V.js";import{D as H,a as G,b as F}from"./dialog-C0jBLeL4.js";import{C as z}from"./coins-CHDYn88-.js";import{G as V}from"./gift-D_6EAVSp.js";import{M as T}from"./music-2-BxvCGknl.js";import{B as q}from"./BottomNav-Bg5oj6EG.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=y("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=y("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=y("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=y("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),W="/PROYECTO--PROGRAWEB-TISTOS/tree/main/FRONTEND/assets/tomba-BDZHZMqZ.png",Y="/PROYECTO--PROGRAWEB-TISTOS/tree/main/FRONTEND/assets/Dina-ChyTXk3Y.png";function X({gift:i,visible:d,onClose:r,durationMs:o=3500}){const[l,f]=a.useState(d),t=a.useRef(null);return a.useEffect(()=>{if(f(d),t.current&&(window.clearTimeout(t.current),t.current=null),!!d)return t.current=window.setTimeout(()=>{f(!1),r(),t.current=null},o),()=>{t.current&&(window.clearTimeout(t.current),t.current=null)}},[d,o,r]),a.useEffect(()=>()=>{t.current&&(window.clearTimeout(t.current),t.current=null)},[]),i?e.jsx("div",{className:`fixed right-8 top-20 z-50 pointer-events-auto transform-gpu ${l?"animate-slide-in":"animate-slide-out"}`,onClick:()=>{t.current&&(window.clearTimeout(t.current),t.current=null),f(!1),r()},children:e.jsxs("div",{className:"flex items-center gap-4 bg-gradient-to-r from-pink-500 to-secondary p-4 rounded-2xl shadow-glow text-white min-w-[300px] max-w-md",children:[e.jsx("img",{src:i.imagen,alt:i.nombre,className:"w-20 h-20 object-contain"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-extrabold text-lg",children:"Â¡Recibiste un regalo!"}),e.jsx("div",{className:"text-md opacity-95",children:i.nombre})]})]})}):null}const Q=[{id:1,nombre:"Tomba",costo:2,puntos:20,imagen:W,descripcion:" Para que nunca te falte el pasaje",ancho:100,alto:100},{id:2,nombre:"Dina",costo:10,puntos:100,imagen:Y,descripcion:" Para tu sopa, segundo y postresito",ancho:150,alto:75}];function ee(){const[i,d]=a.useState("principal");U();const[r,o]=a.useState(50),[l,f]=a.useState(0),[t,u]=a.useState(""),[m,n]=a.useState(null),[j,g]=a.useState(!1),[x,s]=a.useState(null),c=()=>{o(r+100),u("Â¡Has comprado 100 monedas!"),setTimeout(()=>u(""),1500)},[h,b]=a.useState(!1),N=p=>{r>=p.costo?(o(r-p.costo),f(l+p.puntos),u(`Â¡Has enviado una ${p.nombre} y apoyado al streamer!`),s(p),g(!0),setTimeout(()=>u(""),2e3)):(u("No tienes suficientes monedas."),setTimeout(()=>u(""),2e3))};return e.jsxs("div",{children:[e.jsx("button",{className:`flex items-center gap-2\r
            bg-pink-500 hover:bg-pink-600 text-white font-semibold px-4 py-2 rounded-xl shadow-md transition`,onClick:()=>{b(!0)},children:"ðŸŽ"}),e.jsx(H,{open:h,onOpenChange:b,children:e.jsx(G,{className:"sm:max-w-md",children:e.jsxs(F,{children:[e.jsxs("div",{className:"border-b-2 border-white pb-2 mb-4 flex items-center justify-between",children:[e.jsx("h1",{className:"text-pink-600 text-3xl font-bold ",children:"Regalos"}),e.jsxs("div",{className:"text-right",children:[e.jsx("h1",{className:"text-muted-foreground",children:" Saldo"}),e.jsxs("h1",{className:"text-2xl font-bold",children:[r," SOLES"]})]})]}),i==="principal"&&e.jsxs("div",{className:"relative flex justify-start items-start gap-6 min-h-[200px]",children:[Q.map(p=>e.jsx("button",{onClick:()=>{n(p),d("dialogo2")},className:"hover:scale-105 transition",children:e.jsx("img",{src:p.imagen,alt:p.nombre,className:"w-10 h-10 object-contain"})},p.id)),e.jsx("div",{className:"absolute bottom-2 right-2 flex flex-col items-end",children:e.jsxs("div",{className:"flex items-center gap-3 bg-card/50 p-2 rounded-lg backdrop-blur-md",children:[e.jsxs("span",{className:"font-bold text-lg flex items-center gap-2",children:[e.jsx(z,{className:"w-6 h-6 text-yellow-400"})," Monedas"]}),e.jsx(v,{variant:"link",size:"sm",onClick:c,children:"Obtener Monedas"})]})})]}),t&&e.jsx("div",{className:"max-w-xl mx-auto mb-2 text-center text-primary font-semibold",children:t}),i==="dialogo2"&&m&&e.jsxs("div",{className:"max-w-md mx-auto bg-card rounded-xl p-6 text-center",children:[e.jsxs("h3",{className:"text-xl font-bold mb-3 flex items-center justify-center gap-2",children:[e.jsx(V,{className:"w-5 h-5 text-primary"})," ",m.nombre]}),e.jsx("img",{src:m.imagen,alt:m.nombre,style:{width:m.ancho,height:m.alto,objectFit:"contain",margin:"0 auto"},className:"mb-4"}),e.jsxs("p",{className:"text-sm mb-1",children:[" Costo: s/ ",m.costo," "]}),e.jsxs("p",{className:"text-sm mb-4",children:["Puntos: ",m.puntos]}),e.jsxs("p",{className:"text-sm mb-4",children:[" Descripcion:",m.descripcion]}),e.jsxs("div",{className:"flex justify-center gap-4",children:[e.jsx(v,{variant:"secondary",onClick:()=>N(m),children:"Enviar regalo"}),e.jsx(v,{variant:"outline",onClick:()=>d("principal"),children:"Volver"})]})]})]})})}),e.jsx(X,{gift:x?{nombre:x.nombre,imagen:x.imagen}:null,visible:j,onClose:()=>g(!1)})]})}const se=i=>{const d=Math.floor((Date.now()-i)/1e3);if(d<60)return`${d}s`;const r=Math.floor(d/60);if(r<60)return`${r}m`;const o=Math.floor(r/60);return o<24?`${o}h`:`${Math.floor(o/24)}d`},te=({onClose:i,sessionId:d})=>{const[r,o]=a.useState(""),[l,f]=a.useState([{id:1,text:"Â¡QuÃ© buen video!",user:"user_ana-nivel 8â­",likes:3,createdAt:Date.now()-1e3*60*5},{id:2,text:"La ediciÃ³n estÃ¡ top ðŸ”¥",user:"creador123-nivel 10â­",likes:5,createdAt:Date.now()-1e3*60*60}]),t=220;a.useEffect(()=>{try{const s=localStorage.getItem("comments_demo");s&&f(JSON.parse(s))}catch{}},[]),a.useEffect(()=>{try{localStorage.setItem("comments_demo",JSON.stringify(l))}catch{}},[l]);const u=a.useRef(null),m=a.useRef(null),{user:n,setCurrentUser:j}=A();a.useEffect(()=>{var s;(s=u.current)==null||s.focus()},[]),a.useEffect(()=>{m.current&&(m.current.scrollTop=m.current.scrollHeight)},[l]);const g=()=>{if(r.trim()===""||r.length>t)return;const s={id:Date.now(),text:r.trim(),user:n!=null&&n.name&&n.name!=="Usuario Invitado"?n.name:"ulima123 - nivel 5 â­",likes:0,createdAt:Date.now()};f(c=>{const h=[...c,s];try{localStorage.setItem("comments_demo",JSON.stringify(h))}catch{}return h}),o(""),(async()=>{try{if(!d){j({points:((n==null?void 0:n.points)||0)+1});return}const c=await fetch(`${_}/sesiones/${d}/mensajes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_espectador:n==null?void 0:n.id,contenido:s.text})});if(!c.ok){console.warn("Error al enviar mensaje al backend",await c.text()),j({points:((n==null?void 0:n.points)||0)+1});return}const h=await c.json();typeof h.puntos_actuales=="number"?j({points:h.puntos_actuales}):j({points:((n==null?void 0:n.points)||0)+1})}catch(c){console.error("Error enviando mensaje:",c),j({points:((n==null?void 0:n.points)||0)+1})}})()},x=s=>{f(c=>c.map(h=>h.id===s?{...h,likes:h.likes+1}:h))};return e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex justify-center items-end",onClick:i,"aria-modal":"true",role:"dialog",children:e.jsxs("div",{className:"bg-background w-full max-w-2xl h-[75%] rounded-t-2xl grid grid-rows-[auto_1fr_auto] overflow-hidden shadow-xl mb-16",onClick:s=>s.stopPropagation(),children:[e.jsxs("header",{className:"flex items-center justify-between border-b p-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-muted flex items-center justify-center font-bold",children:"A"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold",children:"Comentarios"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[l.length," comentarios"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"text-right mr-2",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Comentando como"}),e.jsx("div",{className:"text-sm font-medium",children:n!=null&&n.name&&n.name!=="Usuario Invitado"?n.name:"ulima123"})]}),e.jsx(v,{variant:"ghost",size:"icon",onClick:i,"aria-label":"Cerrar",children:e.jsx(B,{className:"w-5 h-5"})})]})]}),e.jsx("div",{ref:m,className:"overflow-y-auto p-4 space-y-3",children:l.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-8",children:"AÃºn no hay comentarios. Â¡SÃ© el primero!"}):l.map(s=>e.jsxs("div",{className:"flex gap-3 items-start",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-pink-500 to-yellow-400 flex items-center justify-center text-white font-bold",children:s.user.charAt(0).toUpperCase()}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-sm",children:s.user}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Â· ",se(s.createdAt)]})]}),e.jsx("div",{className:"text-sm mt-1",children:s.text}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-muted-foreground",children:[e.jsxs("button",{onClick:()=>x(s.id),className:"flex items-center gap-1 text-rose-500",children:[e.jsx(D,{className:"w-4 h-4"}),e.jsx("span",{children:s.likes})]}),e.jsx("button",{onClick:()=>{var c;o(`@${s.user} `),(c=u.current)==null||c.focus()},className:"text-muted-foreground",children:"Responder"})]})]})]},s.id))}),e.jsxs("footer",{className:"flex items-center gap-2 border-t p-4 pb-6",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-muted flex items-center justify-center font-bold",children:"J"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("input",{ref:u,type:"text",placeholder:"AÃ±ade un comentario...",value:r,onChange:s=>o(s.target.value),onKeyDown:s=>s.key==="Enter"&&g(),className:"w-full bg-muted border rounded-full px-4 py-2 text-sm focus:outline-none focus:ring-1 focus:ring-primary","aria-label":"AÃ±adir comentario",maxLength:t}),e.jsxs("div",{className:"flex justify-between text-xs mt-1 text-muted-foreground",children:[e.jsxs("span",{className:`${r.length>t?"text-rose-500":""}`,children:[r.length,"/",t]}),e.jsx("span",{className:"text-muted-foreground",children:"Pulsa Enter para enviar"})]})]}),e.jsx(v,{onClick:g,className:"shrink-0",disabled:r.trim()===""||r.length>t,children:"Publicar"})]})]})})},ae=({video:i,isActive:d})=>{const[r,o]=a.useState(!1),[l,f]=a.useState(i.likes),t=a.useRef(null),[u,m]=a.useState(!1);a.useEffect(()=>{t.current&&(d?t.current.play():(t.current.pause(),t.current.currentTime=0))},[d]);const n=()=>{o(!r),f(r?l-1:l+1)},j=({streamerId:x})=>{var E,M;const{user:s}=A(),[c,h]=a.useState(null),[b,N]=a.useState(!1);if(a.useEffect(()=>{if(!(s!=null&&s.id)||!x)return;let C=!0;return N(!0),(async()=>{try{const w=await fetch(`${_}/usuarios/${s.id}/progreso`);if(!w.ok)return;const R=await w.json();if(!C)return;const $=Array.isArray(R)?R.find(O=>{var I;return O.id_streamer===x||((I=O.streamer)==null?void 0:I.id_usuario)===x}):null;h($||null)}catch(w){console.error("Error cargando progreso del canal:",w)}finally{C&&N(!1)}})(),()=>{C=!1}},[x,s==null?void 0:s.id]),!x)return null;if(b)return e.jsx("div",{className:"text-xs text-white/80",children:"Cargando progreso..."});if(!c)return e.jsx("div",{className:"text-xs text-white/70",children:"Sin progreso en este canal"});const p=c.nivel||{},k=c.puntos_actuales||0,S=p.puntos_requeridos??1e3,L=Math.max(S-k,0),P=Math.min(Math.round(k/S*100),100);return e.jsxs("div",{className:"text-white text-sm bg-black/40 px-3 py-2 rounded-md shadow-md",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"text-xs",children:["Canal: ",((E=c.streamer)==null?void 0:E.nombre)||(((M=c.streamer)==null?void 0:M.id_usuario)??"Streamer")]}),e.jsxs("div",{className:"text-xs",children:[k,"/",S]})]}),e.jsx("div",{className:"w-full bg-white/10 rounded-full h-2 mt-2",children:e.jsx("div",{className:"bg-gradient-to-r from-green-400 to-blue-500 h-2 rounded-full",style:{width:`${P}%`}})}),e.jsxs("div",{className:"text-xs text-white/80 mt-1",children:["Faltan ",L," puntos para el siguiente nivel"]})]})},g=x=>x>=1e6?(x/1e6).toFixed(1)+"M":x>=1e3?(x/1e3).toFixed(1)+"K":x.toString();return e.jsxs("div",{className:"snap-item relative h-screen w-screen bg-black",children:[e.jsxs("div",{className:"absolute inset-0",children:[e.jsx("video",{ref:t,className:"h-screen w-screen object-cover",loop:!0,muted:!0,playsInline:!0,poster:`https://picsum.photos/1080/1920?random=${i.id}`,children:e.jsx("source",{src:i.videoUrl,type:"video/mp4"})}),e.jsx("div",{className:"absolute inset-0 gradient-overlay"})]}),e.jsx("button",{className:"absolute inset-0 flex items-center justify-center z-10 group",tabIndex:-1,style:{pointerEvents:"none"},children:e.jsx("div",{className:"opacity-0 group-active:opacity-100 transition-opacity duration-200",children:e.jsx(Z,{className:"w-20 h-20 text-white drop-shadow-2xl",fill:"white"})})}),e.jsxs("div",{className:"absolute right-4 bottom-24 z-30 flex flex-col gap-6",children:[e.jsx("div",{className:"mb-2",children:e.jsx(j,{streamerId:i.streamerId})}),e.jsx(ee,{}),e.jsx("div",{className:"flex flex-col items-center",children:e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:i.avatar,alt:i.username,className:"w-12 h-12 rounded-full border-2 border-white"}),e.jsx("button",{className:"absolute -bottom-2 left-1/2 -translate-x-1/2 w-6 h-6 rounded-full bg-primary flex items-center justify-center text-white text-xl font-bold",children:"+"})]})}),e.jsxs("button",{onClick:n,className:"flex flex-col items-center gap-1",children:[e.jsx(D,{className:`w-8 h-8 transition-all ${r?"fill-primary text-primary animate-heart-pop":"text-white"}`}),e.jsx("span",{className:"text-white text-xs font-semibold text-shadow",children:g(l)})]}),e.jsxs("button",{onClick:()=>m(!0),className:"flex flex-col items-center gap-1",children:[e.jsx(J,{className:"w-8 h-8 text-white"}),e.jsx("span",{className:"text-white text-xs font-semibold text-shadow",children:g(i.comments)})]}),e.jsxs("button",{className:"flex flex-col items-center gap-1",children:[e.jsx(K,{className:"w-8 h-8 text-white"}),e.jsx("span",{className:"text-white text-xs font-semibold text-shadow",children:g(i.shares)})]}),e.jsx("button",{className:"flex flex-col items-center gap-1",children:e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center",children:e.jsx(T,{className:"w-5 h-5 text-white"})})})]}),e.jsxs("div",{className:"absolute bottom-24 left-4 right-20 z-20 animate-slide-up",children:[e.jsxs("h3",{className:"text-white font-bold text-lg mb-1 text-shadow",children:["@",i.username]}),e.jsx("p",{className:"text-white text-sm mb-2 text-shadow line-clamp-2",children:i.caption}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-4 h-4 text-white"}),e.jsx("p",{className:"text-white text-xs text-shadow truncate",children:i.music})]})]}),u&&e.jsx(te,{sessionId:i.id,onClose:()=>m(!1)})]})},ne=[{id:"1",videoUrl:"https://samplelib.com/mp4/sample-5s.mp4",username:"traveler_soul",avatar:"https://api.dicebear.com/7.x/avataaars/svg?seed=Felix",caption:"Chasing sunsets ðŸŒ… #travel #nature",likes:12400,comments:234,shares:89,music:"Summer Vibes â€¢ Chill Beats",sessionId:"session-1",streamerId:"streamer-1"},{id:"2",videoUrl:"https://www.w3schools.com/html/movie.mp4",username:"urban_explorer",avatar:"https://api.dicebear.com/7.x/avataaars/svg?seed=Aneka",caption:"City lights never sleep ðŸŒƒ #citylife #night",likes:23100,comments:456,shares:123,music:"Neon Dreams â€¢ Synthwave",sessionId:"session-2",streamerId:"streamer-2"},{id:"3",videoUrl:"https://www.w3schools.com/html/mov_bbb.mp4",username:"ocean_lover",avatar:"https://api.dicebear.com/7.x/avataaars/svg?seed=Lily",caption:"Ocean therapy ðŸŒŠ #beach #relax",likes:34500,comments:678,shares:234,music:"Ocean Waves â€¢ Nature Sounds",sessionId:"session-3",streamerId:"streamer-3"},{id:"4",videoUrl:"https://filesamples.com/samples/video/mp4/sample_640x360.mp4",username:"mountain_climber",avatar:"https://api.dicebear.com/7.x/avataaars/svg?seed=Max",caption:"Reaching new heights â›°ï¸ #adventure #hiking",likes:18900,comments:345,shares:167,music:"Epic Journey â€¢ Orchestral",sessionId:"session-4",streamerId:"streamer-4"}],re=()=>{const[i,d]=a.useState(0),r=a.useRef(null);return a.useEffect(()=>{const o=r.current;if(!o)return;const l=()=>{const f=o.scrollTop,t=window.innerHeight,u=Math.round(f/t);d(u)};return o.addEventListener("scroll",l),()=>o.removeEventListener("scroll",l)},[]),e.jsx("div",{ref:r,className:"h-screen overflow-y-auto snap-y snap-mandatory",children:ne.map((o,l)=>e.jsx(ae,{video:o,isActive:l===i},o.id))})},fe=()=>e.jsxs("div",{className:"relative min-h-screen bg-background",children:[e.jsx("div",{className:"p-4 flex justify-center"}),e.jsx(re,{}),e.jsx(q,{})]});export{fe as default};
