import{d as I,r as l,j as e,u as k,t as T,v as $,e as O}from"./index-bRf4bcou.js";import{B as _}from"./button-CxmuLj3z.js";import{O as L}from"./OverlayAnimator-CYtZmkqb.js";import{B as E}from"./config-9OvXtyrZ.js";import{A as J}from"./arrow-left-CiOvM4DV.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=I("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),R=[{id:0,label:"+5",coins:5,color:"#ff9ad6"},{id:1,label:"+10",coins:10,color:"#ff66cc"},{id:2,label:"+20",coins:20,color:"#cc66ff"},{id:3,label:"+50",coins:50,color:"#7b2cff"},{id:4,label:"+100",coins:100,color:"#66e0ff"},{id:5,label:"x2",coins:0,color:"#ffd166"}],A=({open:y,costPoints:i,onClose:v,onResult:o,userPoints:d})=>{const[s,g]=l.useState(!1),[N,p]=l.useState(0),[x,h]=l.useState(null),C=l.useRef(null);l.useEffect(()=>{y||(g(!1),h(null),p(0))},[y]);const j=R.length,c=360/j,w=()=>{if(s||d<i)return;g(!0),h(null);const u=Math.floor(Math.random()*j),a=(4+Math.floor(Math.random()*3))*360+(360-u*c-c/2);setTimeout(()=>{p(a),setTimeout(()=>{const t=R[u];h(t),g(!1),t.id===5?o(50,t):o(t.coins,t)},1900)},80)};return y?e.jsxs("div",{style:{position:"fixed",inset:0,zIndex:80,display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("div",{onClick:v,style:{position:"absolute",inset:0,background:"rgba(0,0,0,0.6)"}}),e.jsxs("div",{style:{position:"relative",width:420,background:"#151515",borderRadius:12,padding:18,boxShadow:"0 12px 40px rgba(0,0,0,0.6)",border:"1px solid rgba(120,60,160,0.12)",color:"#fff"},children:[e.jsx("h3",{style:{margin:0},children:"Ruleta de puntos"}),e.jsxs("p",{style:{marginTop:6,color:"#cfc",marginBottom:12},children:["Juega con ",e.jsxs("strong",{children:[i," puntos"]})," para ganar monedas. Tienes ",d," pts."]}),e.jsxs("div",{style:{display:"flex",gap:16,alignItems:"center",justifyContent:"center"},children:[e.jsxs("div",{style:{position:"relative",width:260,height:260},children:[e.jsx("div",{ref:C,style:{width:260,height:260,borderRadius:"50%",overflow:"hidden",transform:`rotate(${N}deg)`,transition:s?"transform 1.9s cubic-bezier(.2,.95,.2,.95)":"none",boxShadow:"0 8px 30px rgba(123,44,255,0.12)"},children:R.map((u,S)=>{const a=S*c;return e.jsx("div",{style:{position:"absolute",left:"50%",top:"50%",width:260,height:260,transformOrigin:"0% 0%",transform:`rotate(${a}deg) translate(-50%, -50%)`,clipPath:"polygon(50% 50%, 0% 100%, 100% 100%)",background:u.color??"#333",display:"flex",alignItems:"flex-end",justifyContent:"center",paddingBottom:28,color:"#111",fontWeight:700,fontSize:14},children:e.jsx("div",{style:{transform:`rotate(${c/2}deg)`},children:u.label})},u.id)})}),e.jsx("div",{style:{position:"absolute",left:"50%",top:"-8px",transform:"translateX(-50%)",width:0,height:0,borderLeft:"12px solid transparent",borderRight:"12px solid transparent",borderBottom:"16px solid #fff"}})]}),e.jsxs("div",{style:{maxWidth:120},children:[e.jsx("div",{style:{marginBottom:8,color:"#ddd"},children:"Resultado"}),e.jsx("div",{style:{minHeight:44,display:"flex",alignItems:"center",justifyContent:"center",background:"#111",borderRadius:8,padding:"8px 10px"},children:s?"Girando...":x?`${x.label} â†’ ${x.coins||"Especial"}`:"Listo"}),e.jsxs("div",{style:{marginTop:12,display:"flex",gap:8},children:[e.jsx("button",{onClick:v,style:{flex:1,background:"transparent",border:"1px solid rgba(255,255,255,0.06)",padding:8,borderRadius:8,color:"#fff"},children:"Cerrar"}),e.jsx("button",{onClick:w,disabled:s||d<i,style:{flex:1,background:d>=i?"linear-gradient(90deg,#ff66cc,#7b2cff)":"#333",border:"none",color:"#fff",padding:8,borderRadius:8,fontWeight:700,cursor:d>=i?"pointer":"not-allowed"},children:"Jugar"})]})]})]}),e.jsxs("div",{style:{marginTop:12,fontSize:13,color:"#9a9a9a"},children:["Tip: ganas puntos cada vez que envÃ­as mensajes. Ahorra ",i," pts para jugar."]})]})]}):null},B=[{id:1,nombre:"Dina",costo:10,puntos:100},{id:2,nombre:"Tomba",costo:2,puntos:20}],m=100,q=()=>{const y=k(),{state:i}=T(),v=$(),o=i==null?void 0:i.chat,d=v.id??(i==null?void 0:i.id_sesion)??"unknown",{toast:s}=O(),[g,N]=l.useState(()=>[{id:"1",text:"Hola, Â¿quÃ© tal?",user:{nombre:(o==null?void 0:o.nombre)??"Contacto"},timestamp:new Date().toISOString()}]),[p,x]=l.useState(""),h=l.useRef(null),[C,j]=l.useState(!1);l.useState(B[0]),l.useEffect(()=>{var t;return(t=h.current)==null?void 0:t.scrollIntoView({behavior:"smooth"})},[g]);const c=()=>{const t=localStorage.getItem("tistos_current_user");return t?JSON.parse(t):null},w=t=>{localStorage.setItem("tistos_current_user",JSON.stringify(t));try{const n=localStorage.getItem("tistos_users"),r=n?JSON.parse(n):[],b=r.findIndex(f=>f.email===t.email||f.id===t.id);b>=0&&(r[b]=t,localStorage.setItem("tistos_users",JSON.stringify(r)))}catch{}},u=async()=>{if(!p.trim())return;const t=c();if(!t){s==null||s({title:"Inicia sesiÃ³n para enviar mensajes",duration:2e3});return}if(!d||d==="unknown"){s==null||s({title:"ID de sesiÃ³n invÃ¡lido",duration:2e3});return}try{const n=await fetch(`${E}/sesiones/${d}/mensajes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_espectador:t.id_usuario,contenido:p.trim()})});if(!n.ok){const f=await n.json();throw console.error("Error del servidor:",f),new Error(f.error||f.details||`Error ${n.status}`)}const r=await n.json(),b={id:r.mensaje.id_mensaje,text:p.trim(),user:{nombre:"Yo"},timestamp:r.mensaje.fecha_hora};N(f=>[...f,b]),x(""),t.points=(t.points??0)+(r.mensaje.puntos_otorgados??1),w(t),s==null||s({title:`Ganaste ${r.mensaje.puntos_otorgados??1} punto`,duration:1e3})}catch(n){s==null||s({title:n instanceof Error?n.message:"Error al enviar mensaje",duration:2e3}),console.error("Error enviando mensaje:",n)}},S=t=>{const n=c();if(!n){s==null||s({title:"Inicia sesiÃ³n para jugar",duration:2e3});return}fetch(`${E}/ruleta/jugar`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_espectador:n.id_usuario,puntos_apostados:m,id_streamer:(o==null?void 0:o.id)||null})}).then(r=>r.ok?r.json():r.json().then(b=>{throw new Error(b.error||"Error al procesar la ruleta")})).then(r=>{n.coins=(n.coins??0)+r.monedas_ganadas,n.points=(n.points??0)-m,w(n),window.dispatchEvent(new CustomEvent("tistos:overlay",{detail:{type:"gift",from:n.nombre??n.email??"Anon",giftName:`Ruleta (+${r.monedas_ganadas} monedas)`,points:r.monedas_ganadas,multiplier:0}})),s==null||s({title:`Â¡Ganaste ${r.monedas_ganadas} monedas!`,description:`Resultado: ${r.resultado_segmento}`,duration:2e3})}).catch(r=>{s==null||s({title:r.message||"Error al procesar la ruleta",duration:2e3}),console.error(r)})},a=c();return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col pb-24",children:[e.jsx(L,{}),e.jsxs("div",{className:"flex items-center gap-2 p-4",children:[e.jsx(_,{variant:"ghost",size:"icon",onClick:()=>y(-1),children:e.jsx(J,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[o!=null&&o.avatar?e.jsx("img",{src:o.avatar,alt:o.nombre,className:"w-10 h-10 rounded-full"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-secondary flex items-center justify-center text-white",children:"U"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:(o==null?void 0:o.nombre)??`Chat ${d}`}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Nivel ",(o==null?void 0:o.level)??"-"]})]})]}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",gap:10,alignItems:"center"},children:[e.jsxs("div",{style:{color:"#fff",fontWeight:700},children:[(a==null?void 0:a.coins)??0," ðŸ’°"]}),e.jsxs("div",{style:{color:"#cfc"},children:[(a==null?void 0:a.points)??0," pts"]})]})]}),e.jsx("div",{className:"flex-1 px-4 overflow-y-auto",children:e.jsxs("div",{className:"mt-4 space-y-3",children:[g.map(t=>e.jsx("div",{className:`flex ${t.user.nombre==="Yo"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[70%] px-3 py-2 rounded-lg ${t.user.nombre==="Yo"?"bg-primary text-white":"bg-card text-white"}`,children:[e.jsx("div",{className:"text-sm",children:t.text}),e.jsx("div",{className:"text-[10px] text-muted-foreground mt-1 text-right",children:new Date(t.timestamp).toLocaleTimeString()})]})},t.id)),e.jsx("div",{ref:h})]})}),e.jsx("div",{className:"fixed bottom-20 left-4 right-4 bg-transparent",children:e.jsxs("button",{onClick:()=>{const t=c();if(!t){s==null||s({title:"Inicia sesiÃ³n para jugar",duration:2e3});return}if((t.points??0)<m){s==null||s({title:`Necesitas ${m} pts para jugar`,duration:2200});return}j(!0)},style:{background:"linear-gradient(90deg,#ff66cc,#7b2cff)",border:"none",color:"#fff",padding:"8px 12px",borderRadius:12,fontWeight:800,cursor:"pointer"},title:`Jugar ruleta (${m} pts)`,children:["ðŸŽ¯ Ruleta (",m," pts)"]})}),e.jsx("div",{className:"fixed bottom-4 left-4 right-4 bg-transparent",children:e.jsx("div",{style:{display:"flex",gap:8,alignItems:"center"},children:e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flex:1},children:[e.jsx("input",{value:p,onChange:t=>x(t.target.value),className:"flex-1 rounded-2xl px-4 py-2 bg-card text-white outline-none",placeholder:"Escribe un mensaje...",onKeyDown:t=>{t.key==="Enter"&&u()}}),e.jsx(_,{onClick:u,size:"sm",variant:"secondary",children:e.jsx(z,{className:"w-4 h-4"})})]})})}),e.jsx(A,{open:C,costPoints:m,userPoints:(a==null?void 0:a.points)??0,onClose:()=>j(!1),onResult:t=>{j(!1),S()}})]})};export{q as default};
