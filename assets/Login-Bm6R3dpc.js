import{r as d,u as y,B as i,j as e,L as m}from"./index-Cw9brnzF.js";import{B as L}from"./button-BxQx3nAy.js";import{L as x,I as g}from"./label-CY0WeuSR.js";import{V as w}from"./video-ChMAtOM1.js";const k=()=>{const[l,f]=d.useState(""),[c,j]=d.useState(""),[u,a]=d.useState(""),N=y();console.log("[Login] BACKEND_URL =",i);const v=async o=>{o.preventDefault(),a(""),console.log("[Login] handleLogin llamado"),console.log("[Login] Enviando a:",`${i}/auth/login`),console.log("[Login] Payload:",{correo:l,contrasena:c});try{const t=await fetch(`${i}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({correo:l,contrasena:c})});let s;try{s=await t.json()}catch{console.warn("[Login] No se pudo parsear JSON de la respuesta"),a("Respuesta inesperada del servidor");return}if(console.log("[Login] Respuesta:",t.status,s),!t.ok){a(s?.error||"Correo y/o contraseña incorrectos");return}let n=s.token,r=s.usuario;if(!r&&n){const{token:p,contrasena_hash:E,...h}=s;h.id_usuario&&(r=h)}if(!n||!r){console.error("[Login] Faltan token o usuario en la respuesta"),a("Respuesta de login inválida del servidor");return}localStorage.setItem("authToken",n),localStorage.setItem("usuario",JSON.stringify(r));try{await fetch(`${i}/usuarios/${r.id_usuario}/inicializar-perfil`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}})}catch(p){console.error("Error al inicializar perfil:",p)}r.rol!=="STREAMER"&&console.warn("El usuario no es streamer. Solo podrá ver transmisiones."),N("/index")}catch(t){console.error("[Login] Error de red/fetch:",t),a("Error al conectar con el servidor")}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 mb-4",children:[e.jsx(w,{className:"w-10 h-10 text-primary"}),e.jsx("h1",{className:"text-4xl font-bold gradient-primary bg-clip-text",children:"Tistos"})]}),e.jsx("p",{className:"text-muted-foreground",children:"Inicia sesión para continuar"})]}),e.jsxs("div",{className:"glassmorphism p-8 rounded-2xl space-y-6",children:[e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"email",children:"Correo"}),e.jsx(g,{id:"email",type:"email",placeholder:"tistos@email.com",value:l,onChange:o=>f(o.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{htmlFor:"password",children:"Contraseña"}),e.jsx(g,{id:"password",type:"password",placeholder:"Contraseña",value:c,onChange:o=>j(o.target.value),required:!0})]}),u&&e.jsx("div",{className:"text-red-500 text-sm text-center",children:u}),e.jsx(L,{type:"submit",className:"w-full",children:"Iniciar sesión"})]}),e.jsxs("div",{className:"text-center text-sm text-muted-foreground",children:["No tienes una cuenta?"," ",e.jsx(m,{to:"/register",className:"text-primary hover:underline",children:"Regístrate"})]})]}),e.jsxs("div",{className:"mt-8 flex justify-center gap-4 text-sm text-muted-foreground",children:[e.jsx(m,{to:"/about",className:"hover:text-primary transition-colors",children:"Nosotros"}),e.jsx("span",{children:"•"}),e.jsx(m,{to:"/terms",className:"hover:text-primary transition-colors",children:"Términos y condiciones"})]})]})})};export{k as default};
